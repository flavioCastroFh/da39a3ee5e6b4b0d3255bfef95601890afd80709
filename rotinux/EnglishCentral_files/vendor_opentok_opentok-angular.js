var mod_pagespeed_L8hp9o0kFW = "if(!window.OT)throw new Error('You must include the OT library before the OT_Angular library');angular.module('opentok',[]).factory('OT',function(){return OT;}).factory('OTSession',['OT','$rootScope',function(OT,$rootScope){var OTSession={streams:[],connections:[],publishers:[],init:function(apiKey,sessionId,token,cb){this.session=OT.initSession(apiKey,sessionId);OTSession.session.on({sessionConnected:function(){OTSession.publishers.forEach(function(publisher){OTSession.session.publish(publisher);});},streamCreated:function(event){$rootScope.$apply(function(){OTSession.streams.push(event.stream);});},streamDestroyed:function(event){$rootScope.$apply(function(){OTSession.streams.splice(OTSession.streams.indexOf(event.stream),1);});},sessionDisconnected:function(){$rootScope.$apply(function(){OTSession.streams.splice(0,OTSession.streams.length);OTSession.connections.splice(0,OTSession.connections.length);});},connectionCreated:function(event){$rootScope.$apply(function(){OTSession.connections.push(event.connection);});},connectionDestroyed:function(event){$rootScope.$apply(function(){OTSession.connections.splice(OTSession.connections.indexOf(event.connection),1);});}});this.session.connect(token,function(err){if(cb)cb(err,OTSession.session);});this.trigger('init');}};OT.$.eventing(OTSession);return OTSession;}]).directive('otLayout',['$window','$parse','OT','OTSession',function($window,$parse,OT,OTSession){return{restrict:'E',link:function(scope,element,attrs){var props=$parse(attrs.props)();var container=initLayoutContainer(element[0],props);var layout=function(){container.layout();scope.$emit('otLayoutComplete');};scope.$watch(function(){return element.children().length;},layout);$window.addEventListener('resize',layout);scope.$on('otLayout',layout);var listenForStreamChange=function listenForStreamChange(){OTSession.session.on('streamPropertyChanged',function(event){if(event.changedProperty==='videoDimensions'){layout();}});};if(OTSession.session)listenForStreamChange();else OTSession.on('init',listenForStreamChange);}};}]).directive('otPublisher',['OTSession',function(OTSession){return{restrict:'E',scope:{props:'&'},link:function(scope,element,attrs){var props=scope.props()||{};props.width=props.width?props.width:angular.element(element).width();props.height=props.height?props.height:angular.element(element).height();var oldChildren=angular.element(element).children();scope.publisher=OT.initPublisher(attrs.apikey||OTSession.session.apiKey,element[0],props,function(err){if(err){scope.$emit('otPublisherError',err,scope.publisher);}});angular.element(element).append(oldChildren);scope.publisher.on({accessDenied:function(){scope.$emit('otAccessDenied');},accessDialogOpened:function(){scope.$emit('otAccessDialogOpened');},accessDialogClosed:function(){scope.$emit('otAccessDialogClosed');},accessAllowed:function(){angular.element(element).addClass('allowed');scope.$emit('otAccessAllowed');},loaded:function(){scope.$emit('otLayout');},streamCreated:function(){scope.$emit('otStreamCreated');},streamDestroyed:function(){scope.$emit('otStreamDestroyed');}});scope.$on('$destroy',function(){if(OTSession.session)OTSession.session.unpublish(scope.publisher);else scope.publisher.destroy();OTSession.publishers=OTSession.publishers.filter(function(publisher){return publisher!==scope.publisher;});scope.publisher=null;});if(OTSession.session&&(OTSession.session.connected||(OTSession.session.isConnected&&OTSession.session.isConnected()))){OTSession.session.publish(scope.publisher,function(err){if(err){scope.$emit('otPublisherError',err,scope.publisher);}});}OTSession.publishers.push(scope.publisher);}};}]).directive('otSubscriber',['OTSession',function(OTSession){return{restrict:'E',scope:{stream:'=',props:'&'},link:function(scope,element){var stream=scope.stream,props=scope.props()||{};props.width=props.width?props.width:angular.element(element).width();props.height=props.height?props.height:angular.element(element).height();var oldChildren=angular.element(element).children();var subscriber=OTSession.session.subscribe(stream,element[0],props,function(err){if(err){scope.$emit('otSubscriberError',err,subscriber);}});subscriber.on('loaded',function(){scope.$emit('otLayout');});angular.element(element).append(oldChildren);scope.$on('$destroy',function(){OTSession.session.unsubscribe(subscriber);});}};}]);";
var mod_pagespeed_gMjhWg2mcL = "if(!window.OT)throw new Error('OpenTok.js not found. You must include the OT library.');angular.module('EcLive',[]).factory('OpenTok',[function(){return OT;}]);angular.module('EcLive').factory('EcLive.classes.Account',[function(){function Account(account){var self=this;self=_.assign(self,account);return self;}Account.prototype={constructor:Account,isTeacher:function(){return _.has(this,'tutorAccountID');},getDisplayName:function(){return this.isTeacher()?this.displayName:this.name;},getThumbnailUrl:function(){return this.isTeacher()?this.thumbnailUrl:'';},getAvatarUrl:function(){return this.isTeacher()?this.profilePictureUrl:'';}};return Account;}]);angular.module('EcLive').factory('EcLive.classes.AppEvent',[function(){function AppEvent(name,data){var self=this;self.name=name;self.data=data;return self;}AppEvent.prototype={constructor:AppEvent};return AppEvent;}]);angular.module('EcLive').factory('EcLive.classes.CountDown',['$interval',function($interval){var MINUTE_IN_MS=60000;var DEFAULT_LATE=0;function CountDown(dateString){var self=this;self.late=DEFAULT_LATE;self.intervalId=null;self.dateString=dateString;self.parsedDate=Date.parse(dateString);self.timeRemaining={};return self;}CountDown.prototype={constructor:CountDown,setLateMark:function(lateAt){self.late=lateAt*-1;},start:function(){var self=this;self.intervalId=$interval(function(){self.timeRemaining=self.getTimeRemaining();if(self.timeRemaining.total<=0){self.stop();}},1000);},stop:function(){$interval.cancel(this.intervalId);},isT1:function(){return this.timeRemaining.total<=MINUTE_IN_MS;},isT15:function(){return this.timeRemaining.total<=MINUTE_IN_MS*15;},isLate:function(){return this.parsedDate-Date.parse(new Date())<this.late;},getMinutes:function(){return this.timeRemaining.minutes;},getSeconds:function(){return this.timeRemaining.seconds;},getTimeRemaining:function(){var t=this.parsedDate-Date.parse(new Date());var seconds=Math.floor((t/1000)%60);var minutes=Math.floor((t/1000/60)%60);var hours=Math.floor((t/(1000*60*60))%24);var days=Math.floor(t/(1000*60*60*24));return{'total':t,'days':days,'hours':hours,'minutes':minutes,'seconds':seconds};}};return CountDown;}]);angular.module('EcLive').factory('EcLive.classes.EcLiveChatMessage',['EcLive.ApplicationService',function(ApplicationService){function EcLiveChatMessage(otSignal){var self=this;self.connectionID=otSignal.from.connectionId;self.content=otSignal.data;self.timestamp=new Date();return self;}EcLiveChatMessage.prototype={constructor:EcLiveChatMessage,isMine:function(){return ApplicationService.session.connection.connectionId===this.connectionID;}};return EcLiveChatMessage;}]);angular.module('EcLive').factory('EcLive.classes.EcLivePublisher',[function(){function EcLivePublisher(otPublisherObject,options){var self=this;self.cameraState=options.publishVideo;self.micState=options.publishAudio;self.otPublisher=otPublisherObject;return self;}EcLivePublisher.prototype={constructor:EcLivePublisher,toggleCamera:function(toggle){var state=!_.isUndefined(toggle)?toggle:!this.cameraState;this.cameraState=state;this.otPublisher.publishVideo(state);},toggleMic:function(toggle){var state=!_.isUndefined(toggle)?toggle:!this.micState;this.micState=state;this.otPublisher.publishAudio(state);}};return EcLivePublisher;}]);angular.module('EcLive').factory('EcLive.classes.EcSession',['$interval','$filter','EcLive.constants.SessionState','EcLive.classes.CountDown','EcLive.AppConfig',function($interval,$filter,SessionState,CountDown,AppConfig){var NO_SHOW_MARK=300000;var PROTOTYPE_PROPERTIES=['isScheduled','isCompleted','isStarted','getDisplayDate','getDisplayTime'];function EcSession(data){var self=this;self=_.assign(self,_.omit(_.clone(data),PROTOTYPE_PROPERTIES));self.countDown=new CountDown(self.schedule);self.countDown.setLateMark(NO_SHOW_MARK);self.countDown.start();self.timeRemaning=false;return self;}EcSession.prototype={constructor:EcSession,start:function(){if(!this.timeRemaning){this.timeRemaning=new CountDown(new Date((new Date(this.schedule)).getTime()+AppConfig.getSessionDurationMinutes()*60000));this.timeRemaning.start();this.sessionState=SessionState.STARTED;}},isScheduled:function(){return this.sessionState===SessionState.COMPLETED||this.status===SessionState.SCHEDULED;},isCompleted:function(){return this.sessionState===SessionState.SESSION.COMPLETED||this.status===SessionState.SCHEDULED;},isStarted:function(){return this.sessionState===SessionState.STARTED||this.status===SessionState.STARTED;},getDisplayDate:function(){if(_.has(this,'displayScheduleWithTimezone')){return this.displayScheduleWithTimezone;}if(_.has(this,'displayDate')){return this.displayDate;}this.displayDate=new Date(this.schedule);return this.displayDate;},getDisplayTime:function(){if(_.has(this,'displayTime')){return this.displayTime;}var date=new Date(this.schedule);var hours=$filter('pad')(date.getHours(),2,'0');var minutes=$filter('pad')(date.getMinutes(),2,'0');this.displayTime=hours+':'+minutes;return this.displayDate;}};return EcSession;}]);(function(angular){var APP_STATES={ONLINE:'online',OFFLINE:'offline',LOADING:'loading',STARTED:'started'};angular.module('EcLive').constant('EcLive.constants.AppState',APP_STATES);})(angular);(function(angular){var COMMON={APP_STATE:{STARTED:'started',ONGOING:'ongoing',ENDED:'ended'}};angular.module('EcLive').constant('EcLive.constants.common',COMMON);})(angular);(function(angular){var CONFIG={sessionDurationMinutes:30,templatePath:'views',templateExt:'html'};angular.module('EcLive').constant('EcLive.constants.Config',CONFIG);})(angular);(function(angular){var EVENTS={};EVENTS.APPLICATION={CONNECTION_CREATED:'connectionCreated',CONNECTION_DESTROYED:'connectionDestroyed',DISCONNECT:'disconnect',PEER_CONNECTED:'peerConnected',PEER_DISCONNECTED:'peerDisconnected',SESSION_INITIALIZED:'sessionInitialized',SESSION_START:'sessionStart',SESSION_END:'sessionEnd',SESSION_DESTROYED:'sessionDestroyed',SESSION_NO_SHOW:'sessionNoShow',DEVICE_SHARE:'deviceShare',MIC_SETUP:'micSetup',MIC_TOGGLE:'micToggle',CAMERA_SHARE:'cameraShare',CAMERA_TOGGLED:'cameraToggled',PUBLISHER_INITIALIZED:'publisherInitialized'};EVENTS.API={SESSION_INITIALIZED:EVENTS.APPLICATION.SESSION_INITIALIZED,SESSION_NO_SHOW:EVENTS.APPLICATION.SESSION_NO_SHOW,DISCONNECT:EVENTS.APPLICATION.DISCONNECT,PEER_DISCONNECTED:EVENTS.APPLICATION.PEER_DISCONNECTED,DEVICE_SHARE:EVENTS.APPLICATION.DEVICE_SHARE,MIC_SETUP:EVENTS.APPLICATION.MIC_SETUP,MIC_TOGGLE:EVENTS.APPLICATION.MIC_TOGGLE,CAMERA_SHARE:EVENTS.APPLICATION.CAMERA_SHARE,CAMERA_TOGGLED:EVENTS.APPLICATION.CAMERA_TOGGLED,RATING_CLICK:'ratingClick',RATING_SUBMIT:'ratingSubmit'};angular.module('EcLive').constant('EcLive.Events',EVENTS);})(angular);(function(angular){var SESSION_STATE={SCHEDULED:'Scheduled',COMPLETED:'Completed',MISSED:'Missed',STARTED:'Started'};angular.module('EcLive').constant('EcLive.constants.SessionState',SESSION_STATE);})(angular);(function(angular){var SIGNALS={};SIGNALS={CHAT_MESSAGE:'signal:EcLiveChatMessage',SESSION:{START:'start'}};angular.module('EcLive').constant('EcLive.constants.Signals',SIGNALS);})(angular);angular.module('EcLive').controller('EcLive.ChatController',['$scope','$element','EcLive.ApplicationService','EcLive.classes.EcLiveChatMessage','EcLive.Events','EcLive.Logger',function($scope,$element,ApplicationService,EcLiveChatMessage,Events,Logger){var _chatSignal='signal:EcLiveChatMessage';var _chatFeed=$element[0].querySelector('.chat-feed');var self=this;self.isReady=false;self.messages=[];self.draftMessage='';self.thumnail='';self.send=function(){if(_.trim(self.draftMessage).length===0){return null;}ApplicationService.sendChatMessage(self.draftMessage);self.draftMessage='';};self.getThumbnail=function(isMine){return(isMine)?ApplicationService.account.getThumbnailUrl():ApplicationService.peer.getThumbnailUrl();};if(!_.isEmpty(ApplicationService.session)){init(ApplicationService.session);}else{ApplicationService.on(ApplicationService.Events.SESSION_INITIALIZED,function(){init(ApplicationService.session);});}ApplicationService.on(ApplicationService.Events.SESSION_DESTROYED,function(){self.isReady=false;self.messages=[];self.draftMessage='';self.thumnail='';});function init(session){self.isReady=true;session.on(_chatSignal,function(otSignal){$scope.$apply(function(){self.messages.push(new EcLiveChatMessage(otSignal));});_chatFeed.scrollTop=_chatFeed.scrollHeight;});}}]);angular.module('EcLive').controller('EcLive.ControlsController',['EcLive.ApplicationService','EcLive.AppStateService','EcLive.classes.AppEvent',function(ApplicationService,AppStateService,AppEvent){var self=this;self.startSession=function(){ApplicationService.startSession();};self.isTutor=function(){return!_.isEmpty(ApplicationService.account)&&ApplicationService.account.isTeacher();};self.endSession=function(){ApplicationService.endSession();ApplicationService.session.disconnect();};self.disconnect=function(){ApplicationService.disconnect();};self.toggleCamera=function(){ApplicationService.publisher.toggleCamera();ApplicationService.trigger(ApplicationService.Events.MIC_TOGGLE,new AppEvent(ApplicationService.Events.MIC_TOGGLE,{state:ApplicationService.publisher.cameraState}));};self.hasSessionStarted=function(){return AppStateService.hasStarted();};self.toggleMic=function(){ApplicationService.publisher.toggleMic();ApplicationService.trigger(ApplicationService.Events.MIC_TOGGLE,new AppEvent(ApplicationService.Events.MIC_TOGGLE,{state:ApplicationService.publisher.micState}));};self.getTimer=function(){return ApplicationService.ecSession.timeRemaning;};self.getCameraState=function(){return ApplicationService.publisher.cameraState;};self.getMicState=function(){return ApplicationService.publisher.micState;};self.isCameraEnabled=function(){return ApplicationService.isCameraEnabled;};self.isMicEnabled=function(){return ApplicationService.isMicEnabled;};}]);angular.module('EcLive').controller('EcLive.EcSessionScheduleController',['$interval','EcLive.ApplicationService',function($interval,ApplicationService){var self=this;var _session={};self.getDisplayTime=function(){return(!_.isEmpty(_session))?_session.getDisplayTime():'';};self.getDisplayDate=function(){return(!_.isEmpty(_session))?_session.getDisplayDate():'';};self.getHoursFromNow=function(){return!_.isEmpty(_session)?_session.countDown.timeRemaining.hours:0;};self.getMinutesFromNow=function(){return!_.isEmpty(_session)?_session.countDown.timeRemaining.minutes:0;};self.getSecondsFromNow=function(){return!_.isEmpty(_session)?_session.countDown.timeRemaining.seconds:0;};if(!_.isEmpty(ApplicationService.ecSession)){init(ApplicationService.ecSession);}else{ApplicationService.on(ApplicationService.Events.SESSION_INITIALIZED,function(){init(ApplicationService.ecSession);});}function init(session){_session=session;}}]);angular.module('EcLive').controller('EcLive.MainController',['$scope','EcLive.ApplicationService','EcLive.AppStateService','BrowserService',function($scope,ApplicationService,AppStateService,BrowserService){var self=this;self.showNotice=true;self.sessionEnded=false;self.isChatVisible=true;self.browser=BrowserService;self.isT1=function(){return!_.isEmpty(ApplicationService.ecSession)?ApplicationService.ecSession.countDown.isT1():false;};self.toggleChat=function(){self.isChatVisible=!self.isChatVisible;};self.getAccount=function(){return ApplicationService.account;};self.getPeer=function(){return ApplicationService.peer;};self.getPeerName=function(){return!_.isEmpty(ApplicationService.peer)?ApplicationService.peer.getDisplayName():'';};self.getTutor=function(){return ApplicationService.tutor;};self.getSession=function(){return ApplicationService.ecSession;};self.getStreams=function(){return ApplicationService.streams;};self.isReady=function(){return ApplicationService.isReady;};self.isLoading=function(){return ApplicationService.isLoading;};self.showAccessDialog=function(){return!self.isLoading()&&!ApplicationService.accessAllowed&&!self.isOffline();};self.showMicConnectingMessage=function(){return!self.isLoading()&&ApplicationService.accessAllowed&&!self.isMicConnected();};self.showMicTestDialog=function(){return!self.isLoading()&&self.isMicConnected()&&ApplicationService.accessAllowed&&!self.isSessionDisconnected();};self.showWaitingMessage=function(){return!self.isLoading()&&ApplicationService.accessAllowed&&self.isMicChecked()&&!self.isSessionDisconnected()&&ApplicationService.streams.length===0&&!ApplicationService.ecSession.countDown.isLate();};self.showSessionTimer=function(){return ApplicationService.connections.length>1;};self.sessionStarted=function(){return ApplicationService.streams.length>0;};self.isMicConnected=function(){return ApplicationService.isMicConnected;};self.isMicChecked=function(){return ApplicationService.isMicChecked;};self.isSessionDisconnected=function(){return ApplicationService.sessionEnded;};self.hasSessionEnded=function(){return ApplicationService.sessionEnded;};self.isNoShow=function(){return!AppStateService.hasStarted()&&ApplicationService.ecSession.countDown.isLate();};self.hasSubstitute=function(){return!AppStateService.hasStarted()&&!_.isEmpty(ApplicationService.substituteTutor);};self.showRatingForm=function(){return!_.isEmpty(ApplicationService.ecSession)&&_.has(ApplicationService.ecSession,'isCompleted')&&ApplicationService.ecSession.isCompleted()&&!ApplicationService.account.isTeacher();};self.isOffline=function(){return AppStateService.isOffline();};ApplicationService.on(ApplicationService.Events.SESSION_INITIALIZED,function(){self.account=ApplicationService.account;self.peer=ApplicationService.peer;self.session=ApplicationService.ecSession;$scope.$watch(function(){return self.session.countDown.isLate();},function(isLate){if(isLate){ApplicationService.trigger(ApplicationService.Events.SESSION_NO_SHOW);}});});$scope.$on('$destroy',function(){ApplicationService.destroySession();});}]);angular.module('EcLive').controller('EcLive.MicTestController',['$scope','OpenTok','EcLive.ApplicationService','EcLive.classes.AppEvent','EcLive.Logger',function($scope,OpenTok,ApplicationService,AppEvent,Logger){var self=this;var _publisher={};self.microphones=[];self.sectedMic='';self.vuBars=[1,2,3,4,5,6,7,8,9,10];self.vuLength=self.vuBars.length;self.isQuiet=false;self.isAudible=false;self.showQuiet=function(){return self.microphones.length&&!self.isAudible&&self.isQuiet;};self.showAudible=function(){return self.microphones.length&&self.isAudible;};self.showTitle=function(){return self.microphones.length&&!self.showQuiet()&&!self.showAudible()&&!self.isError();};self.isError=function(){return _.isEmpty(self.microphones)||!self.microphones.length;};self.getClass=function(index){var dividend=(index+1)/self.vuLength;if(dividend<=0.5){return'low';}if(dividend>0.5&&dividend<0.7){return'med';}if(dividend>=0.7&&dividend<0.8){return'med-high';}if(dividend>0.7){return'high';}};ApplicationService.on(ApplicationService.Events.PUBLISHER_INITIALIZED,function(publisher){_publisher=publisher;_publisher.otPublisher.on({accessAllowed:function(event){self.initDevices();}});});self.initDevices=function(){ApplicationService.getMicDevicesPromise().then(function(devices){self.microphones=devices;self.sectedMic=(devices.length)?_.first(devices):{};});};self.dismiss=function(){ApplicationService.isMicChecked=true;ApplicationService.publisher.toggleMic(false);ApplicationService.trigger(ApplicationService.Events.MIC_SETUP,new AppEvent(ApplicationService.Events.MIC_SETUP,{state:true,success:true}));$scope.$destroy();};}]);angular.module('EcLive').directive('ecLive',['EcLive.AppConfig',function(AppConfig){return{restrict:'A',replace:true,controller:'EcLive.MainController',controllerAs:'ecLive',templateUrl:AppConfig.getTemplatePath()+'/ec-live.'+AppConfig.getTemplateExt(),link:function(scope,element,attrs){scope.$on('$destroy',function(event){});}};}]);angular.module('EcLive').directive('ecLiveAvatar',['EcLive.AppConfig',function(AppConfig){var DEFAULT_SIZE='small';var LARGE='large';var SIZES=[DEFAULT_SIZE,LARGE];return{restrict:'A',replace:true,scope:{account:'='},templateUrl:AppConfig.getTemplatePath()+'/widgets/ec-live-avatar.'+AppConfig.getTemplateExt(),link:function(scope,element,attr){scope.size=attr.ecLiveAvatar&&_.includes(SIZES,attr.ecLiveAvatar)?attr.ecLiveAvatar:DEFAULT_SIZE;scope.getImage=function(){switch(scope.size){case LARGE:return scope.account.getAvatarUrl();case DEFAULT_SIZE:return scope.account.getThumbnailUrl();default:return scope.account.getThumbnailUrl();}};scope.getTeacherName=function(){return scope.account.getDisplayName();};}};}]);angular.module('EcLive').directive('ecLiveChat',['EcLive.AppConfig',function(AppConfig){return{restrict:'A',replace:true,scope:true,controller:'EcLive.ChatController',controllerAs:'chat',templateUrl:AppConfig.getTemplatePath()+'/ec-live-chat.'+AppConfig.getTemplateExt(),link:function(scope,element,attrs){}};}]);angular.module('EcLive').directive('ecLiveDialog',['$timeout',function($timeout){var paddingOffset=30;return{restrict:'AC',link:function(scope,element,attrs){var unreg=scope.$watch(function(){return{width:element[0].offsetWidth,height:element[0].offsetHeight};},function(newOffset){if(newOffset.width>0){$timeout(function(){element.css({'margin-left':-(newOffset.width/2)-paddingOffset+'px'});element.css({'margin-top':-(newOffset.height/2)-paddingOffset+'px'});unreg();});}},true);}};}]);angular.module('EcLive').directive('ecLiveMicTest',['$timeout','EcLive.ApplicationService','EcLive.AppConfig','EcLive.classes.AppEvent',function($timeout,ApplicationService,AppConfig,AppEvent){return{restrict:'A',replace:true,templateUrl:AppConfig.getTemplatePath()+'/message-box/mic-test.'+AppConfig.getTemplateExt(),scope:true,controller:'EcLive.MicTestController',controllerAs:'micTest',link:function(scope,element,attrs){var _timeoutDuration=1000;var _timeoutQuietDuration=4000;var _audibleThreshold=20;var _quietThreshold=10;var _audibleTimeout=null;var _quietTimeout=null;var _activeMeter=angular.element(element[0].querySelector('.active-meter'));var _currentVolumeLevel=0;var _frames=0;var _frameThreshold=5;var _publisher={};var _vuMeterWrap=angular.element(element[0].querySelector('.vu-meter-wrap'));var _marginOffset=1;var _barWidth=0;var _quietTracked=false;var _audibleTracked=false;scope.micTest.getBarLength=function(){if(_barWidth===0){_barWidth=(_vuMeterWrap[0].offsetWidth/scope.micTest.vuLength)-_marginOffset;}return _barWidth;};_activeMeter.css({width:_currentVolumeLevel});ApplicationService.on(ApplicationService.Events.PUBLISHER_INITIALIZED,function(publisher){_publisher=publisher;_publisher.otPublisher.on({audioLevelUpdated:function(event){ApplicationService.isMicConnected=true;_frames++;if(_frames==61){_frames=0;}if(_frames%_frameThreshold!==0){return;}if(!event||!event.audioLevel){return;}var _newVolume=event.audioLevel.toFixed(1)*100;var _applyVolume=isRoundEqual(_currentVolumeLevel,_newVolume)?_currentVolumeLevel:(_newVolume<_currentVolumeLevel&&_currentVolumeLevel>5)?_currentVolumeLevel-5:_newVolume;_activeMeter.css({width:_applyVolume+'%'});if(_applyVolume>_audibleThreshold&&_.isEmpty(_audibleTimeout)){_audibleTimeout=$timeout(function(){scope.micTest.isAudible=true;},_timeoutDuration);if(!_audibleTracked){ApplicationService.trigger(ApplicationService.Events.MIC_SETUP,new AppEvent(ApplicationService.Events.MIC_SETUP,{state:true}));_audibleTracked=true;}}if(_applyVolume<_quietThreshold&&_.isEmpty(_audibleTimeout)){_quietTimeout=$timeout(function(){scope.micTest.isQuiet=true;},_timeoutQuietDuration);if(!_quietTracked){ApplicationService.trigger(ApplicationService.Events.MIC_SETUP,new AppEvent(ApplicationService.Events.MIC_SETUP,{state:false}));_quietTracked=true;}}if(!_.isEmpty(_audibleTimeout)){$timeout.cancel(_quietTimeout);}}});});scope.$on('$destroy',function(){_publisher.otPublisher.off();element.remove();});function isRoundEqual(oldVal,newVal){return Math.round(oldVal)==Math.round(newVal);}}};}]);angular.module('EcLive').controller('ecLivePublisherController',['$scope','OpenTok','EcLive.ApplicationService','EcLive.Events','EcLive.classes.EcLivePublisher','EcLive.classes.AppEvent','EcLive.Logger',function($scope,OpenTok,ApplicationService,Events,EcLivePublisher,AppEvent,Logger){var self=this;var _defaultProperty={insertMode:'append',height:'100%',width:'100%',showControls:false,audioFallbackEnabled:true,frameRate:15,resolution:'320x240',publishAudio:true,publishVideo:true};self.initialize=function(container,name){if(name){_defaultProperty.name=name;}if(ApplicationService.account.isTeacher()){_defaultProperty.publishVideo=false;}ApplicationService.getDevicesPromise().then(function(devices){if(ApplicationService.devicesHaveCameras(devices).length===0){_defaultProperty.videoSource=null;}console.log(container);self.publisher=new EcLivePublisher(OpenTok.initPublisher(ApplicationService.session.apiKey,container,_defaultProperty,function(error){if(error){}else{console.log('Publisher initialized.');}}),_defaultProperty);ApplicationService.publisher=self.publisher;ApplicationService.publisher.otPublisher.on({accessDialogOpened:accessDialogOpened,accessAllowed:accessAllowed,accessDenied:accessDenied});ApplicationService.trigger(ApplicationService.Events.PUBLISHER_INITIALIZED,ApplicationService.publisher);});};self.destroy=function(){ApplicationService.publisher.otPublisher.off();ApplicationService.publisher={};};function accessDialogOpened(event){Logger.log(event);$scope.$apply(function(){ApplicationService.isLoading=false;});}function accessAllowed(event){Logger.log(event);$scope.$apply(function(){ApplicationService.accessAllowed=true;ApplicationService.isLoading=false;});ApplicationService.trigger(ApplicationService.Events.MIC_SETUP,new AppEvent(ApplicationService.Events.DEVICE_SHARE,{success:true}));}function accessDenied(event){Logger.log(event);$scope.$apply(function(){ApplicationService.accessAllowed=false;});ApplicationService.trigger(ApplicationService.Events.MIC_SETUP,new AppEvent(ApplicationService.Events.DEVICE_SHARE,{success:false}));}}]).directive('ecLivePublisher',['EcLive.ApplicationService','EcLive.AppConfig',function(ApplicationService,AppConfig){return{restrict:'A',replace:true,templateUrl:AppConfig.getTemplatePath()+'/widgets/publisher.'+AppConfig.getTemplateExt(),controller:'ecLivePublisherController',controllerAs:'ecLivePublisher',scope:true,link:function(scope,element,attrs){var container=element[0].querySelector('.ot-video-wrap');if(ApplicationService.session&&!_.isEmpty(ApplicationService.session)){scope.ecLivePublisher.initialize(container,ApplicationService.account.getDisplayName());}else{ApplicationService.on(ApplicationService.Events.SESSION_INITIALIZED,function(data){scope.ecLivePublisher.initialize(container,ApplicationService.account.getDisplayName());});}}};}]);angular.module('EcLive').directive('ecLiveRate',['EcLive.API','EcLive.AppConfig',function(API,AppConfig){var STARS=[1,2,3,4,5];return{templateUrl:AppConfig.getTemplatePath()+'/message-box/ec-live-rate.'+AppConfig.getTemplateExt(),scope:{tutor:'=tutor'},link:function(scope,element,attrs){scope.stars=STARS;scope.rating=0;scope.rate=function(rating){scope.rating=rating;};scope.dismiss=function(){scope.$destroy();};scope.submitRating=function(){API.trigger(API.Events.RATING_SUBMIT,{rating:scope.rating});scope.dismiss();};scope.$on('$destroy',function(){element.remove();});}};}]);angular.module('EcLive').directive('ecLiveSessionTimer',['$interval','EcLive.ApplicationService','EcLive.Events',function($interval,ApplicationService,Events){return{link:function(scope,element,attrs){var _timeStart;var _baseTime;var _interval;var _limit=1200000;var _intervalTime=1000;ApplicationService.on(ApplicationService.Events.SESSION_START,function(){init(ApplicationService.ecSession);});function init(session){_baseTime=(session.baseTime)?session.baseTime:(new Date()).getMilliseconds();_timeStart=session.schedule;start(0);}function start(offset){_limit+=offset;_interval=$interval(function(){if(_limit===0){$interval.cancel(_interval);return;}scope.minutes=Math.floor(_limit/1000/60);scope.seconds=Math.floor((_limit/1000)%60);_limit-=_intervalTime;},_intervalTime);}}};}]);angular.module('EcLive').controller('EcLiveStreamController',['$scope','EcLive.ApplicationService','EcLive.Logger',function($scope,ApplicationService,Logger){var self=this;var _defaultProperty={height:'100%',width:'100%',insertMode:'append',showControls:false,audioFallbackEnabled:true,frameRate:15,resolution:'320x240',subscribeToAudio:true,subscribeToVideo:true};var _stream=$scope.stream;self.stream=$scope.stream;self.initialize=function(container){self.subscriber=ApplicationService.session.subscribe(_stream,container,_defaultProperty,function(error){if(error){Logger.log(error);}});};self.getName=function(){return self.stream.name;};}]).directive('ecLiveStream',['EcLive.AppConfig',function(AppConfig){return{restrict:'A',controller:'EcLiveStreamController',controllerAs:'ecLiveStream',templateUrl:AppConfig.getTemplatePath()+'/stream.'+AppConfig.getTemplateExt(),replace:true,scope:{stream:'=ecLiveStream'},link:function(scope,element){scope.ecLiveStream.initialize(element[0].querySelector('.ot-video-wrap'));}};}]);angular.module('EcLive').directive('ecSessionSchedule',['EcLive.AppConfig',function(AppConfig){return{restrict:'A',scope:true,controller:'EcLive.EcSessionScheduleController',controllerAs:'ecSession',templateUrl:AppConfig.getTemplatePath()+'/message-box/session-schedule.'+AppConfig.getTemplateExt(),link:function(scope,element,attrs){}};}]);angular.module('EcLive').directive('onFocusKeypressCallback',[function(){var KEY_CODE={enter:13};return{scope:{onFocusKeypressCallback:'&'},link:function(scope,element,attrs){var _keyCode=KEY_CODE[attrs.onFocusKeypress];if(!_.isFunction(scope.onFocusKeypressCallback)){return false;}init();scope.$on('$destroy',function(){destroy();});function init(){element.on('keypress',function(event){if(event.keyCode===_keyCode||event.charCode===_keyCode&&!event.shiftKey){scope.onFocusKeypressCallback();event.preventDefault();return false;}});}function destroy(){element.off();}}};}]);angular.module('EcLive').filter('pad',function(){function pad(input,length,padString){if(_.isUndefined(input)||_.isUndefined(padString)||length<input.length){return input;}input=input.toString();padString=padString.toString();return(new Array(Math.ceil((length-input.length)/padString.length)+1).join(padString)).substr(0,(length-input.length))+input;}return function(input,length,padString){return!_.isUndefined(input)?pad(input,length,padString):input;};});angular.module('EcLive').service('EcLive.API',['EcLive.ApplicationService','EcLive.Logger','EcLive.Events',function(ApplicationService,Logger,Events){var _callbacks={};var _subscriberID=0;var Service={};Service.Events=Events.API;Service.startSession=function(ecSession,opentokParams){ApplicationService.initialize(ecSession,opentokParams);};Service.substituteTutor=function(substituteTutor){ApplicationService.substituteTutor=substituteTutor;};Service.on=function(eventName,callback){if(!_.isFunction(callback)){return false;}if(_.isEmpty(_callbacks[eventName])){_callbacks[eventName]={};}var id=_subscriberID++;_callbacks[eventName][id]=callback;return function(){delete(_callbacks[eventName][id]);};};Service.off=function(eventName){if(_.isEmpty(eventName)||_.isUndefined(eventName)){_callbacks={};}_callbacks[eventName]={};};Service.trigger=function(eventName,event){if(!_.isEmpty(_callbacks[eventName])){_.forEach(_callbacks[eventName],function(callback){if(_.isFunction(callback)){callback(event);}});}};Service.setFetchSubstituteCallback=function(callback){ApplicationService.onFetchSubstitute=callback;};ApplicationService.on(ApplicationService.Events.SESSION_INITIALIZED,function(session){Service.trigger(Service.Events.SESSION_INITIALIZED,session);});ApplicationService.on(ApplicationService.Events.SESSION_NO_SHOW,function(){Service.trigger(Service.Events.SESSION_NO_SHOW);});ApplicationService.on(ApplicationService.Events.DISCONNECT,function(){Service.trigger(Service.Events.DISCONNECT);});ApplicationService.on(ApplicationService.Events.PEER_DISCONNECTED,function(event){Service.trigger(Service.Events.PEER_DISCONNECTED,event);});ApplicationService.on(ApplicationService.Events.DEVICE_SHARE,function(event){Service.trigger(Service.Events.DEVICE_SHARE,event);});ApplicationService.on(ApplicationService.Events.MIC_SETUP,function(event){Service.trigger(Service.Events.MIC_SETUP,event);});ApplicationService.on(ApplicationService.Events.MIC_TOGGLE,function(event){Service.trigger(Service.Events.MIC_TOGGLE,event);});ApplicationService.on(ApplicationService.Events.CAMERA_SHARE,function(event){Service.trigger(Service.Events.CAMERA_SHARE,event);});ApplicationService.on(ApplicationService.Events.CAMERA_TOGGLED,function(event){Service.trigger(Service.Events.CAMERA_TOGGLED,event);});return Service;}]);angular.module('EcLive').provider('EcLive.AppConfig',[function(){var _configVariables={};this.setConfigVariables=function(params){_configVariables=params;};this.$get=['EcLive.constants.Config',function(Config){var Service={};var _configVars=_.assign(Service,Config,_configVariables);Service.getOpentokKey=function(){return Service.getConfigVar('opentokKey','');};Service.getTemplatePath=function(){return Service.getConfigVar('templatePath','');};Service.getTemplateExt=function(){return Service.getConfigVar('templateExt','');};Service.getSessionDurationMinutes=function(){return Service.getConfigVar('sessionDurationMinutes',0);};Service.getConfigVar=function(varName,defaltReturnValue){return(_configVars[varName])?_configVars[varName]:(!_.isUndefined(defaltReturnValue)?defaltReturnValue:null);};return Service;}];}]);angular.module('EcLive').service('EcLive.AppStateService',['EcLive.constants.AppState','EcLive.classes.CountDown','EcLive.AppConfig',function(AppState,CountDown,AppConfig){var Service={};var _appState=null;var _sessionState=null;var _sessionTimer;Service.startSession=function(){_appState=AppState.STARTED;};Service.endSession=function(){_sessionState=AppState.ENDED;};Service.disconnect=function(){_appState=AppState.OFFLINE;};Service.loading=function(){_appState=AppState.LOADING;};Service.isLoading=function(){return _appState===AppState.LOADING;};Service.isOffline=function(){return _appState===AppState.OFFLINE;};Service.hasStarted=function(){return _appState===AppState.STARTED;};return Service;}]);angular.module('EcLive').service('EcLive.ApplicationService',['$rootScope','$q','EcLive.Logger','EcLive.Events','EcLive.constants.Signals','EcLive.classes.AppEvent','EcLive.classes.EcSession','EcLive.classes.Account','EcLive.classes.signals.OtChatMessageSignal','EcLive.classes.signals.OtSessionSignal','EcLive.AppStateService','EcLive.AppConfig','OpenTok',function($rootScope,$q,Logger,Events,Signals,AppEvent,EcSession,Account,OtChatMessageSignal,OtSessionSignal,AppStateService,AppConfig,OpenTok){var Service={};var _sessionSignal='signal:EcLiveSession';Service.Events=Events.APPLICATION;Service.sessionState='';Service.isReady=false;Service.sessionEnded=false;Service.accessAllowed=false;Service.isMicChecked=false;Service.isCameraChecked=false;Service.isMicConnected=false;Service.isCameraConnected=false;Service.isMicEnabled=false;Service.isCameraEnabled=false;Service.isTutorOnline=false;Service.isTuteeOnline=false;Service.elapsedTime={};Service.ecSession={};Service.session={};Service.publisher={};Service.connections=[];Service.streams=[];Service.devices=[];Service.substituteTutor={};Service.tutorRest={};Service.initialize=function(session,opentokParams,tutorRest){Service.tutorRest=tutorRest;Service.isLoading=true;Service.ecSession=new EcSession(session);Service.account=new Account(session.account);Service.peer=new Account(session.peer);Service.tutor=new Account(session.tutor);Logger.log('EcLive.API.key:',AppConfig.getOpentokKey());Logger.log('EcLive.API.initializing:',Service.ecSession);Logger.log('EcLive.API.initializing:',opentokParams);Service.session=OpenTok.initSession(AppConfig.getOpentokKey(),opentokParams.sessionID);Service.session.on({sessionConnected:function(event){Logger.log('OpenTok.session.sessionConnected:',event);Service.session.publish(Service.publisher.otPublisher,function(error){if(error){Logger.log('Service.session.publish::',error);return null;}});Service.getDevicesPromise().then(function(devices){console.log(devices);Service.isMicEnabled=_.filter(devices,{'kind':'audioInput'}).length;Service.isCameraEnabled=_.filter(devices,{'kind':'videoInput'}).length;});},streamCreated:function(event){Logger.log('OpenTok.session.streamCreated:',event);$rootScope.$apply(function(){Service.streams.push(event.stream);});},streamDestroyed:function(event){Logger.log('OpenTok.session.streamDestroyed',event);Service.streams.splice(Service.streams.indexOf(event.stream),1);},sessionDisconnected:function(event){Logger.log('OpenTok.session.sessionDisconnected:',event);Service.streams.splice(0,Service.streams.length);Service.connections.splice(0,Service.connections.length);},connectionCreated:function(event){Logger.log('OpenTok.session.connectionCreated:',event);Service.connections.push(event.connection);if(event.connection.connectionId!==Service.session.connection.connectionId){Service.trigger(Service.Events.PEER_CONNECTED,event);}},connectionDestroyed:function(event){Logger.log('OpenTok.session.connectionDestroyed:',event);Service.connections.splice(Service.connections.indexOf(event.connection),1);if(event.connection.connectionId!==Service.session.connection.connectionId){Service.trigger(Service.Events.PEER_DISCONNECTED,new AppEvent(Service.Events.PEER_DISCONNECTED,event));}}});Service.session.connect(opentokParams.token,function(error){if(error){Logger.log('OpenTok.session.connectionError: ',error);}});Service.trigger(Service.Events.SESSION_INITIALIZED,new AppEvent(Service.Events.SESSION_INITIALIZED,Service.session));Service.session.on(_sessionSignal,function(state){if(state.data=='start'){Service.trigger(Service.Events.SESSION_START,new AppEvent(Service.Events.SESSION_START,Service.session));if(!Service.account.isTeacher()){AppStateService.startSession();}}else{Service.trigger(Service.Events.SESSION_END,new AppEvent(Service.Events.SESSION_END,Service.session));}});Service.isLoading=false;Service.isReady=true;};Service.getDevicesPromise=function(){var deferred=$q.defer();OpenTok.getDevices(function(error,devices){if(error){Logger.log('ApplicationService.getMicDevicesPromise',error);deferred.resolve([]);return null;}deferred.resolve(devices);});return deferred.promise;};Service.getMicDevicesPromise=function(){var deferred=$q.defer();OpenTok.getDevices(function(error,devices){if(error){Logger.log('ApplicationService.getMicDevicesPromise',error);deferred.resolve([]);return null;}deferred.resolve(_.filter(devices,function(device){return device.kind==='audioInput';}));});return deferred.promise;};Service.devicesHaveCameras=function(devices){return _.filter(devices,function(device){return device.kind==='videoInput';});};Service.sendChatMessage=function(message){Service.session.signal(new OtChatMessageSignal(message),function(error){if(error){Logger.log('ApplicationService.sendChatMessage',error);}});};Service.startSession=function(){if(Service.account.isTeacher()){Service.session.signal(new OtSessionSignal(Signals.SESSION.START),function(error){if(error){Logger.log('ApplicationService.startSession',error);}});AppStateService.startSession();Service.publisher.toggleMic(true);Service.publisher.toggleCamera(true);Service.ecSession.start();Service.trigger(Service.Events.SESSION_START,new AppEvent(Service.Events.SESSION_START,Service));}};Service.endSession=function(){if(Service.account.isTeacher()){Service.trigger(Service.Events.SESSION_END,new AppEvent(Service.Events.SESSION_END,Service));}};var _callbacks={};var _subscriberID=0;Service.on=function(eventName,callback){if(!_.isFunction(callback)){return false;}if(_.isEmpty(_callbacks[eventName])){_callbacks[eventName]={};}var id=_subscriberID++;_callbacks[eventName][id]=callback;return function(){delete(_callbacks[eventName][id]);};};Service.trigger=function(eventName,event){if(!_.isEmpty(_callbacks[eventName])){_.forEach(_callbacks[eventName],function(callback){if(_.isFunction(callback)){callback(event);}});}};Service.disconnect=function(){Service.destroySession();AppStateService.disconnect();};Service.destroySession=function(){Service.isInitialized=false;Service.accessAllowed=false;Service.isMicChecked=false;Service.isCameraChecked=false;Service.isMicConnected=false;Service.isCameraConnected=false;Service.ecSession={};Service.session.unpublish(Service.publisher.otPublisher);Service.publisher.otPublisher.off();Service.publisher.otPublisher.destroy();Service.publisher={};Service.connections=[];_.forEach(Service.streams,function(stream){Service.session.unsubscribe(stream);});Service.streams=[];Service.user={};Service.devices=[];Service.session.off();Service.session.disconnect();Service.session={};Service.trigger(Service.Events.SESSION_DESTROYED);};return Service;}]);angular.module('EcLive').service('BrowserService',[function(){var Service={};var isOpera=(!!window.opr&&!!opr.addons)||!!window.opera||navigator.userAgent.indexOf(' OPR/')>=0;var isFirefox=typeof InstallTrigger!=='undefined';var isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf('Constructor')>0;var isIE=!!document.documentMode;var isEdge=!isIE&&!!window.StyleMedia;var isChrome=!!window.chrome&&!!window.chrome.webstore;var isBlink=(isChrome||isOpera)&&!!window.CSS;Service.isFirefox=function(){return isFirefox;};Service.isChrome=function(){return isChrome;};Service.isSafari=function(){return isSafari;};Service.isIE=function(){return isIE;};Service.isEdge=function(){return isEdge;};return Service;}]);angular.module('EcLive').service('EcLive.Logger',['$log',function($log){var _isDebug=true;return{log:(_isDebug)?$log.log:function(){}};}]);angular.module('EcLive').factory('EcLive.classes.signals.OtChatMessageSignal',[function(){function OtChatMessageSignal(messageString){var self=this;self.retryAfterReconnect=true;self.data=messageString;self.type='EcLiveChatMessage';return self;}OtChatMessageSignal.prototype={constructor:OtChatMessageSignal};return OtChatMessageSignal;}]);angular.module('EcLive').factory('EcLive.classes.signals.OtSessionSignal',[function(){function OtSessionSignal(state){var self=this;self.retryAfterReconnect=true;self.data=state;self.type='EcLiveSession';return self;}OtSessionSignal.prototype={constructor:OtSessionSignal};return OtSessionSignal;}]);";
var mod_pagespeed_hGj79dpzGH = "!function(e){try{e=angular.module(\"EcLive\")}catch(i){e=angular.module(\"EcLive\",[])}e.run([\"$templateCache\",function(e){e.put(\"views/ec-live-chat.html\",'<div ng-class=\"{disabled: !chat.isReady}\" class=\"ec-live-chat\"><button ng-click=\"ecLive.toggleChat()\" ng-show=\"ecLive.isChatVisible\" class=\"toggle-chat btn btn-xs default\">hide chat <i class=\"fa fa-angle-double-right\"></i></button><div class=\"chat-box\"><div class=\"chat-feed\"><div ng-repeat=\"message in chat.messages\" class=\"message-wrap\"><div ng-class=\"{\\'pull-right\\': message.isMine()}\" class=\"message-avatar vertical-align-top text-center\"><img ng-src=\"{{chat.getThumbnail(message.isMine())}}\"></div><div ng-class=\"{\\'pull-right\\': !message.isMine()}\" class=\"message-content vertical-align-top\"><div ng-class=\"{mine: message.isMine()}\" class=\"message-content-inner\"><span ng-bind=\"message.content\"></span></div></div></div></div></div><div class=\"chat-input\"><textarea ng-model=\"chat.draftMessage\" ng-trim=\"true\" ng-disabled=\"!chat.isReady\" on-focus-keypress-callback=\"chat.send()\" on-focus-keypress=\"enter\" class=\"vertical-align-top\" placeholder=\"Enter your message here\"></textarea> <button ng-click=\"chat.send()\" ng-disabled=\"!chat.isReady\" ng-class=\"{disabled:!chat.isReady}\" class=\"btn btn-send-message vertical-align-middle\"><i class=\"fa fa-ellipsis-h\"></i></button></div></div>')}])}(),function(e){try{e=angular.module(\"EcLive\")}catch(i){e=angular.module(\"EcLive\",[])}e.run([\"$templateCache\",function(e){e.put(\"views/ec-live-controls.html\",'<div ng-controller=\"EcLive.ControlsController as controls\" class=\"ec-live-controls\"><div ng-show=\"ecLive.isReady()\"><button ng-click=\"controls.disconnect()\" ng-disabled=\"!ecLive.isReady()\" class=\"btn phone\"></button> <button ng-click=\"controls.toggleMic()\" ng-class=\"{enabled: controls.isMicEnabled(), disabled: !controls.isMicEnabled(), \\'toggle-off\\': !controls.getMicState()}\" ng-disabled=\"!controls.isMicEnabled()\" class=\"btn mic\"></button> <button ng-click=\"controls.toggleCamera()\" ng-class=\"{enabled: controls.isCameraEnabled(), disabled: !controls.isCameraEnabled(), \\'toggle-off\\': !controls.getCameraState()}\" ng-disabled=\"!controls.isCameraEnabled()\" class=\"btn cam\"></button> <button ng-if=\"controls.isTutor()\" ng-click=\"controls.startSession()\" class=\"btn no-sprite\"><i ng-class=\"{\\'fa-hourglass-start\\': !controls.hasSessionStarted(), \\'fa-hourglass-end\\': controls.hasSessionStarted()}\" class=\"fa fa-hourglass-start\"></i></button><div ng-if=\"controls.hasSessionStarted()\" ec-live-session-timer=\"\" class=\"vertical-align-middle\">Lesson Time Remaining <span ng-bind=\"controls.getTimer().getMinutes() | pad:2:0\"></span> : <span ng-bind=\"controls.getTimer().getSeconds() | pad:2:0\"></span>.</div></div></div>')}])}(),function(e){try{e=angular.module(\"EcLive\")}catch(i){e=angular.module(\"EcLive\",[])}e.run([\"$templateCache\",function(e){e.put(\"views/ec-live.html\",'<div ng-class=\"{\\'chat-hidden\\': !ecLive.isChatVisible}\" class=\"ec-live\"><div class=\"ec-live-publisher-stream-wrap vertical-align-top\"><button ng-click=\"ecLive.toggleChat()\" ng-show=\"!ecLive.isChatVisible\" class=\"toggle-chat btn btn-xs default\"><i class=\"fa fa-angle-double-left\"></i> show chat</button><div ng-if=\"ecLive.isReady()\"><div ng-include=\"\" src=\"\\'views/message-box/get-ready.html\\'\" ng-show=\"ecLive.showAccessDialog()\" class=\"get-ready ec-live-dialog text-center\"></div><div ng-include=\"\" src=\"\\'views/message-box/loading.html\\'\" ng-show=\"ecLive.isLoading()\" class=\"waiting-dialog ec-live-dialog\"></div><div ng-include=\"\" src=\"\\'views/message-box/mic-connecting.html\\'\" ng-show=\"ecLive.showMicConnectingMessage()\" class=\"waiting-dialog ec-live-dialog\"></div><div ec-live-mic-test=\"\" ng-show=\"ecLive.showMicTestDialog()\" class=\"test-mic-dialog ec-live-dialog ec-live-mic-test\"></div><div ng-include=\"\" src=\"\\'views/message-box/waiting-dialog.html\\'\" ng-show=\"ecLive.showWaitingMessage()\" class=\"waiting-dialog ec-live-dialog\"></div><div ng-show=\"ecLive.showRatingForm()\" ec-live-rate=\"\" tutor=\"ecLive.getTutor()\" class=\"ec-live-dialog\"></div><div ng-include=\"\" src=\"\\'views/message-box/offline.html\\'\" ng-show=\"ecLive.isOffline()\" class=\"no-tutors ec-live-dialog text-center\"></div><div class=\"ec-live-streams\"><div ng-repeat=\"stream in ecLive.getStreams()\" ec-live-stream=\"stream\"></div><i ng-if=\"ecLive.streams.length === 0\" class=\"fa fa-user text-center\"></i></div></div><div ec-live-publisher=\"\"></div><div ng-include=\"\" src=\"\\'views/ec-live-controls.html\\'\"></div></div><div ec-live-chat=\"\" ng-show=\"ecLive.isChatVisible\" class=\"vertical-align-top\"></div></div>')}])}(),function(e){try{e=angular.module(\"EcLive\")}catch(i){e=angular.module(\"EcLive\",[])}e.run([\"$templateCache\",function(e){e.put(\"views/stream.html\",'<div class=\"ec-live-stream\"><div class=\"stream-name-wrap text-center\"><div class=\"stream-name\"><div class=\"transparent-bg\"></div><div class=\"transparent-bg-fg\"><span ng-bind=\"ecLiveStream.getName()\"></span></div></div></div><div class=\"ot-video-wrap\"></div></div>')}])}(),function(e){try{e=angular.module(\"EcLive\")}catch(i){e=angular.module(\"EcLive\",[])}e.run([\"$templateCache\",function(e){e.put(\"views/message-box/ec-live-rate.html\",'<div class=\"dialog-content\"><div class=\"transparent-bg\"></div><div class=\"transparent-bg-fg text-center\"><div class=\"ec-live-rate\"><div ec-live-avatar=\"large\" account=\"tutor\" class=\"vertical-align-middle\"></div><div class=\"vertical-align-middle text-left\"><div class=\"h3\">Rate your lesson:</div><div class=\"rating-stars\"><div ng-repeat=\"star in stars\" ng-click=\"rate($index+1)\" class=\"vertical-align-middle\"><i ng-class=\"{\\'fa-star-o\\': rating === 0 || rating < $index+1, \\'fa-star\\': rating >= $index+1}\" class=\"fa fa-star-o\"></i></div></div><div>Your lesson report is coming soon</div></div><div class=\"text-right\"><button ng-click=\"dismiss()\" class=\"btn btn-sm btn-danger\">Close</button> <button ng-click=\"submitRating()\" class=\"btn btn-sm btn-success\">Rate</button></div></div></div></div>')}])}(),function(e){try{e=angular.module(\"EcLive\")}catch(i){e=angular.module(\"EcLive\",[])}e.run([\"$templateCache\",function(e){e.put(\"views/message-box/get-ready.html\",'<div class=\"dialog-content\"><div class=\"transparent-bg\"></div><div class=\"transparent-bg-fg\"><div class=\"dialog-body\"><p>Your lesson will start soon.</p><p class=\"message\">This application requires access to your camera and microphone. <span ng-if=\"ecLive.browser.isFirefox()\">Please click \"Share Selected Devices\" above.</span> <span ng-if=\"ecLive.browser.isChrome()\">Please click \"Allow\" above.</span> <span ng-if=\"ecLive.browser.isIE() || ecLive.browser.isEdge()\">Please click \"Yes Allow Access\" above.</span></p></div></div></div>')}])}(),function(e){try{e=angular.module(\"EcLive\")}catch(i){e=angular.module(\"EcLive\",[])}e.run([\"$templateCache\",function(e){e.put(\"views/message-box/loading.html\",'<div class=\"dialog-content\"><div class=\"transparent-bg\"></div><div class=\"transparent-bg-fg text-center\"><div class=\"h4\">Loading...</div><div><i class=\"fa fa-spinner fa-spin fa-3x fa-fw\"></i></div></div></div>')}])}(),function(e){try{e=angular.module(\"EcLive\")}catch(i){e=angular.module(\"EcLive\",[])}e.run([\"$templateCache\",function(e){e.put(\"views/message-box/mic-connecting.html\",'<div class=\"dialog-content\"><div class=\"transparent-bg\"></div><div class=\"transparent-bg-fg text-center\"><div class=\"h4\">Connecting to Microphone...</div><div><i class=\"fa fa-spinner fa-spin fa-3x fa-fw\"></i></div></div></div>')}])}(),function(e){try{e=angular.module(\"EcLive\")}catch(i){e=angular.module(\"EcLive\",[])}e.run([\"$templateCache\",function(e){e.put(\"views/message-box/mic-not-installed.html\",'<div><div class=\"dialog-content\"><div class=\"transparent-bg\"></div><div class=\"transparent-bg-fg\"><div class=\"dialog-header\"><em>Please make sure your microphone is installed correctly.</em></div><div class=\"dialog-body\"><div class=\"form-inline\"><div class=\"form-group\"><label for=\"microphone\">Microphone</label><select ng-options=\"device as device.label for device in micTest.microphones track by device.deviceId\" ng-model=\"micTest.sectedMic\" disabled=\"\" class=\"form-control\" id=\"microphone\"></select></div><div class=\"form-group\"><label>Volume</label><div class=\"vu-meter-wrap\"><div class=\"vu-meter inactive-meter\"><div ng-repeat=\"bar in micTest.vuBars\" ng-style=\"{width:{{micTest.getBarLength()}} +\\'px\\'}\" class=\"vu-bar pull-left\"></div></div></div></div></div></div></div></div></div>')}])}(),function(e){try{e=angular.module(\"EcLive\")}catch(i){e=angular.module(\"EcLive\",[])}e.run([\"$templateCache\",function(e){e.put(\"views/message-box/mic-test.html\",'<div><div class=\"dialog-content\"><div class=\"transparent-bg\"></div><div class=\"transparent-bg-fg\"><div class=\"dialog-header mic-status\"><em ng-if=\"micTest.showTitle()\">Let\\'s test your microphone</em> <em ng-if=\"micTest.isError()\" class=\"mic-unavailable\">No microphone connected or detected</em> <em ng-if=\"micTest.showAudible()\" class=\"mic-successful\">Your microphone is working correctly</em> <em ng-if=\"micTest.showQuiet()\" class=\"mic-soundless\">Your microphone is connected but no sound</em></div><div class=\"dialog-body\"><div class=\"form-inline\"><div class=\"form-group\"><label for=\"microphone\">Microphone</label> <span ng-if=\"!micTest.microphones.length\" class=\"mic-indicator-unavailable\"><i class=\"fa fa-times\" aria-hidden=\"true\"></i></span> <span ng-if=\"micTest.microphones.length\" class=\"mic-indicator-successful\"><i class=\"fa fa-check\" aria-hidden=\"true\"></i></span><select ng-options=\"device as device.label for device in micTest.microphones track by device.deviceId\" ng-model=\"micTest.sectedMic\" class=\"form-control\" id=\"microphone\" ng-disabled=\"!micTest.microphones.length\"></select></div><div class=\"form-group\"><label>Volume</label> <span ng-class=\"{ \\'success\\': micTest.showAudible(), \\'warning\\': micTest.showQuiet(), \\'error\\': micTest.isError() }\" class=\"volume-indicator\"><i ng-class=\"{ \\'fa-check\\': micTest.showAudible(), \\'fa-exclamation\\': micTest.showQuiet() }\" class=\"fa\" aria-hidden=\"true\"></i></span><div class=\"vu-meter-wrap\"><div class=\"vu-meter active-meter\"><div class=\"meter-width\"><div ng-repeat=\"bar in micTest.vuBars\" ng-style=\"{width:{{micTest.getBarLength()}} +\\'px\\'}\" class=\"vu-bar pull-left {{micTest.getClass($index)}}\"></div></div></div><div class=\"vu-meter inactive-meter\"><div ng-repeat=\"bar in micTest.vuBars\" ng-style=\"{width:{{micTest.getBarLength()}} +\\'px\\'}\" class=\"vu-bar pull-left\"></div></div></div><div ng-if=\"micTest.showQuiet()\" class=\"volume-error-message\">Please check if your volume is low or muted.</div></div></div></div><div class=\"dialog-footer text-right text-right\"><a ng-click=\"micTest.dismiss()\" ng-if=\"micTest.microphones.length && micTest.isAudible\" class=\"ec-link\">Continue &raquo;</a></div></div></div></div>')}])}(),function(e){try{e=angular.module(\"EcLive\")}catch(i){e=angular.module(\"EcLive\",[])}e.run([\"$templateCache\",function(e){e.put(\"views/message-box/no-show.html\",'<div class=\"dialog-content\"><div class=\"transparent-bg\"></div><div class=\"transparent-bg-fg text-center\"><div ng-if=\"!ecLive.hasSubstitute()\"><p><strong>There are no tutors available in the next 90 minutes.</strong></p><p class=\"message\">Please pick a time for your lesson.</p></div><div ng-if=\"ecLive.hasSubstitute()\"><p>Sorry, but <strong ng-bind=\"ecLive.getPeerName()\" class=\"em\"></strong> is no longer available, but <strong ng-bind=\"ecLive.getSubstituteName()\" class=\"em\"></strong> is.</p><div ec-live-avatar=\"large\" account=\"ecLive.getPeer()\" class=\"vertical-align-middle\"></div><div class=\"vertical-align-middle\"><div ec-session-schedule=\"\"></div></div></div></div></div>')}])}(),function(e){try{e=angular.module(\"EcLive\")}catch(i){e=angular.module(\"EcLive\",[])}e.run([\"$templateCache\",function(e){e.put(\"views/message-box/offline.html\",'<div class=\"dialog-content\"><div class=\"transparent-bg\"></div><div class=\"transparent-bg-fg text-center\"><h4>Offline</h4></div></div>')}])}(),function(e){try{e=angular.module(\"EcLive\")}catch(i){e=angular.module(\"EcLive\",[])}e.run([\"$templateCache\",function(e){e.put(\"views/message-box/peer-connection-state.html\",'<div class=\"dialog-content\"><div class=\"transparent-bg\"></div><div class=\"transparent-bg-fg text-center\"><div class=\"h4\"><span ng-bind=\"ecLive.getPeerName()\"></span> has disconnected.</div><div>Please wait for them to reconnect.</div><div><i class=\"fa fa-spinner fa-spin fa-3x fa-fw\"></i></div></div></div>')}])}(),function(e){try{e=angular.module(\"EcLive\")}catch(i){e=angular.module(\"EcLive\",[])}e.run([\"$templateCache\",function(e){e.put(\"views/message-box/session-schedule.html\",'<div class=\"ec-session-schedule\"><div class=\"session-schedule-wrap\"><div ng-if=\"ecSession.getHoursFromNow() >= 24\" class=\"session-schedule\"><span>Lesson Date:</span> <strong ng-bind=\"ecSession.getDisplayDate() | date : \\'short\\'\"></strong></div><div ng-if=\"ecSession.getHoursFromNow() < 24\"><div class=\"session-schedule\"><span>Lesson Time:</span> <strong ng-bind=\"ecSession.getDisplayTime()\"></strong></div><div class=\"session-start-time\"><span ng-if=\"ecSession.getHoursFromNow() > 0\"><strong ng-bind=\"ecSession.getHoursFromNow()\"></strong> <strong ng-show=\"ecSession.getHoursFromNow() <= 1\">hour</strong> <strong ng-show=\"ecSession.getHoursFromNow() > 1\">hours</strong></span> <strong ng-bind=\"ecSession.getMinutesFromNow()\"></strong> <strong ng-if=\"ecSession.getMinutesFromNow() == 1\">minute from now.</strong> <strong ng-if=\"ecSession.getMinutesFromNow() > 1\">minutes from now.</strong></div></div></div></div>')}])}(),function(e){try{e=angular.module(\"EcLive\")}catch(i){e=angular.module(\"EcLive\",[])}e.run([\"$templateCache\",function(e){e.put(\"views/message-box/waiting-dialog.html\",'<div class=\"dialog-content\"><div class=\"transparent-bg\"></div><div class=\"transparent-bg-fg text-center\"><div ng-if=\"!ecLive.isT1()\"><div ec-live-avatar=\"large\" account=\"ecLive.getPeer()\" class=\"vertical-align-middle\"></div><div class=\"vertical-align-middle\"><div ec-session-schedule=\"\"></div></div></div><div ng-if=\"ecLive.isT1()\"><div class=\"dialog-header text-center\">Waiting for <span ng-bind=\"ecLive.getPeerName()\"></span>...</div><div><i class=\"fa fa-spinner fa-spin fa-3x fa-fw\"></i></div></div></div></div>')}])}(),function(e){try{e=angular.module(\"EcLive\")}catch(i){e=angular.module(\"EcLive\",[])}e.run([\"$templateCache\",function(e){e.put(\"views/widgets/ec-live-avatar.html\",'<div class=\"ec-live-avatar {{size}}\"><div ng-if=\"account\"><img ng-src=\"{{getImage()}}\" ng-if=\"getImage()\"> <i class=\"fa fa-user\" ng-if=\"!getImage()\"></i><div class=\"teacher-name\" ng-bind=\"getTeacherName()\"></div></div></div>')}])}(),function(e){try{e=angular.module(\"EcLive\")}catch(i){e=angular.module(\"EcLive\",[])}e.run([\"$templateCache\",function(e){e.put(\"views/widgets/publisher.html\",'<div class=\"ec-live-publisher\"><div id=\"publisher-video-wrap\"></div><div class=\"ot-video-wrap\"></div></div>')}])}();";
var mod_pagespeed_4cE_gNHk2V = "(function(angular,_){angular.module('EnglishCentralApp').factory('ActivityEventService',['$q','EC_CONFIG','ConnectionFactory','IdentityAccountService',ActivityEventService]);function ActivityEventService($q,Config,ConnectionFactory,IdentityAccountService){var ACTIVITY_WATCH=9;var ACTIVITY_LEARN=10;var ACTIVITY_SPEAK=11;var ACTIVITY_SIMPLE_PRONUNCIATION=13;var SESSION_TYPE_SINGLE_VIDEO=1;var SESSION_TYPE_CLIPLIST_WORD=10;var SESSION_TYPE_CLIPLIST_PET=11;var SESSION_TYPE_CLIPLIST_LINES=12;var Service={};var DialogActivityREST=ConnectionFactory.get('reportcard').one('event');var _activityEventObservers=[];function rejectPromise(error){var deferred=$q.defer();var promise=deferred.promise;deferred.reject(error);return promise;}function notifyObservers(observers,data){_.map(observers,function(callback){if(typeof callback=='function'){callback(data);}});}Service.subscribeActivityEventUpdate=function(subscriber,callback){_activityEventObservers.push(callback);};Service.post=function(events){if(Config.isBot){return rejectPromise('bot not allowed to do progress');}if(!events||!events.length){return rejectPromise('no events found');}return DialogActivityREST.post(null,events).then(function(){notifyObservers(_activityEventObservers);});};function generateActivitySessionId(activityId){var userId=IdentityAccountService.getIdentity().id||IdentityAccountService.getIdentity().arrivalID;return activityId+userId+_.getTimestamp();}Service.startActivityWatch=function(activityId){if(Config.isBot){return rejectPromise('bot not allowed to do progress');}return this.post([{type:'StartActivityWatch',activityID:activityId,activityTypeID:ACTIVITY_WATCH,activitySessionID:generateActivitySessionId(activityId),eventTime:_.getBsonDate()}]);};Service.completeActivityWatch=function(activityId){if(Config.isBot){return rejectPromise('bot not allowed to do progress');}return this.post([{type:'CompleteActivityWatch',activityID:activityId,activityTypeID:ACTIVITY_WATCH,activitySessionID:generateActivitySessionId(activityId),eventTime:_.getBsonDate(),correct:0,total:0}]);};Service.startDialogLineWatch=function(activityId,dialogLineId,lineCount,progress,sessionTypeId){if(Config.isBot){return rejectPromise('bot not allowed to do progress');}if(!sessionTypeId){sessionTypeId=SESSION_TYPE_SINGLE_VIDEO;}return this.post([{type:'DialogLineWatch',activityID:activityId,activityTypeID:ACTIVITY_WATCH,activitySessionID:generateActivitySessionId(activityId),eventTime:_.getBsonDate(),dialogLineID:dialogLineId,lineCount:lineCount,sessionLineTimeKey:2014051509992837,progress:progress,sessionTypeID:sessionTypeId}]);};Service.setDialogAsFavorite=function(dialogId,isFavorite){if(Config.isBot){return rejectPromise('bot not allowed to do progress');}return this.post([{type:'FavoriteDialog',eventTime:_.getBsonDate(),dialogID:dialogId,markAs:isFavorite}]);};Service.completeActivitySimplePronunciation=function(activityId){if(Config.isBot){return rejectPromise('bot not allowed to do progress');}return this.post([{type:'CompleteActivitySimplePronunciation',activityTypeID:ACTIVITY_SIMPLE_PRONUNCIATION,activitySessionID:generateActivitySessionId(activityId),activityID:activityId,eventTime:_.getBsonDate()}]);};return Service;}})(window.angular,window._);";
var mod_pagespeed_2FylzTTYWi = "(function(angular,_){var MY_LESSONS='mylessons',MY_VIDEOS='myvideos',MY_COURSES='mycourses';var CONSTANTS={MY_LESSONS:MY_LESSONS,MY_VIDEOS:MY_VIDEOS,MY_COURSES:MY_COURSES,VALID_TABS:[MY_LESSONS,MY_VIDEOS,MY_COURSES],TABS:[{id:MY_LESSONS,name:'My Lessons'},{id:MY_VIDEOS,name:'My Videos'},{id:MY_COURSES,name:'My Courses'}]};angular.module('EnglishCentralApp').constant('MyEnglishConstants',CONSTANTS);})(window.angular,window._);";
var mod_pagespeed__DczZThkkQ = "(function(angular,_){angular.module('EnglishCentralApp').factory('MyEnglishService',['$q','LocalCacheService','ConnectionFactory','IdentityAccountService','ContentDialogListService',MyEnglishService]);function MyEnglishService($q,Cache,ConnectionFactory,IdentityAccountService,ContentDialogListService){var NS='MyEnglishService';var NS_MY_VIDEOS=NS+'MyVideos';var NS_MY_COURSES=NS+'MyCourses';var NS_MY_VIDEOS_COUNT=NS+'MyVideosCount';var NS_MY_COURSES_COUNT=NS+'MyCoursesCount';var MyEnglishREST=ConnectionFactory.get('commerce').one('my').one('english');var DEFAULT_COURSE_FIELDS={fields:'courseIDs',coursePage:0,coursePageSize:9};var Service={FILTER:{ALL:'All',GOLIVE:'GoLiveReady',INPROGRESS:'InProgress',COMPLETED:'Completed',FAVORITES:'Favorites'},DIFFICULTY:{ALL:'1,2,3,4,5,6,7',BEGINNER_LEVEL1:1,BEGINNER_LEVEL2:2,INTERMEDIATE_LEVEL3:3,INTERMEDIATE_LEVEL4:4,ADVANCED_LEVEL5:5,ADVANCED_LEVEL6:6,ADVANCED_LEVEL7:7},PROGRESS:{ALL:'All',COMPLETED:'Completed',INPROGRESS:'InProgress'}};Service.PAGE_SIZE=12;var defaultParams={page:0,pageSize:Service.PAGE_SIZE,difficulty:Service.DIFFICULTY.ALL,filter:Service.FILTER.ALL,sortBy:ContentDialogListService.SORT.LASTVIEWED,progress:Service.PROGRESS.ALL};var NS='MyEnglishService';var key='Settings';Service.deleteMyCoursesCache=function(){Cache.removePaginationCache(NS_MY_COURSES,getMyCoursesPaginationCacheKey);Cache.remove(NS_MY_COURSES_COUNT,getMyCoursesCountCacheKey());Cache.removeLocalCacheNamespace(NS);Cache.removeLocalCacheNamespace(NS_MY_COURSES);Cache.removeLocalCacheNamespace(NS_MY_COURSES_COUNT);};Service.deleteMyVideosCache=function(){Cache.removeLocalCacheNamespace(NS);Cache.removeLocalCacheNamespace(NS_MY_VIDEOS);Cache.removeLocalCacheNamespace(NS_MY_VIDEOS_COUNT);};Service.deleteListCache=function(params){if(!params){params={};}Cache.remove(NS,params);};Service.deleteSettingsCache=function(){Cache.removeLegacyCookie(\"EnglishCentral.EC_MyEnglishService_Settings\");};Service.getList=function(params){if(!IdentityAccountService.hasIdentity()){return rejectPromise('Anonymous');}if(!params){params={};}var query=params;var generate=function(){return MyEnglishREST.get(query);};return Cache.getPromise(NS,query,generate,null,ConnectionFactory.getCacheExpiration('commerce'));};Service.getMyCourses=function(params){if(!params){params={};}var generate=function(){return MyEnglishREST.one('course').customGET(null,params,{Accept:ConnectionFactory.getAcceptHeaderV2()});};return Cache.getPromise(NS_MY_COURSES,getMyCoursesCacheKey(params),generate,null,ConnectionFactory.getCacheExpiration('commerce')).then(buildMyCourses,rejectPromise);};Service.getMyCoursesCount=function(params){if(!params){params={};}var sanitizeParams=_.sanitizeQuery(params,['difficulty','progress','filter','classID','groupID']);var generate=function(){return MyEnglishREST.one('course').one('count').customGET(null,sanitizeParams,{Accept:ConnectionFactory.getAcceptHeaderV2()});};return Cache.getPromise(NS_MY_COURSES_COUNT,getMyCoursesCountCacheKey(sanitizeParams),generate,null,ConnectionFactory.getCacheExpiration('commerce')).then(buildMyCoursesCount,rejectPromise);};Service.getMyVideos=function(params){if(!params){params={};}var generate=function(){return MyEnglishREST.one('video').customGET(null,params,{Accept:ConnectionFactory.getAcceptHeaderV2()});};return Cache.getPromise(NS_MY_VIDEOS,getMyVideosCacheKey(params),generate,null,ConnectionFactory.getCacheExpiration('commerce')).then(buildNewMyVideos,rejectPromise);};Service.getMyVideosCount=function(params){if(!params){params={};}var sanitizeParams=_.sanitizeQuery(params,['difficulty','progress','filter','classID','groupID']);var generate=function(){return MyEnglishREST.one('video').one('count').customGET(null,sanitizeParams,{Accept:ConnectionFactory.getAcceptHeaderV2()});};return Cache.getPromise(NS_MY_VIDEOS_COUNT,getMyVideosCountCacheKey(params),generate,null,ConnectionFactory.getCacheExpiration('commerce')).then(buildMyVideosCount,rejectPromise);};Service.getCurrentParams=function(params){if(!_.isObject(params)){params={};}var cachedParams=Cache.getCookie(NS,key);if(_.isEmpty(cachedParams)){return _.assign(defaultParams,params);}return JSON.parse(cachedParams);};Service.updateParams=function(pageSize,params){if(!_.isObject(params)){params={};}var currentParams=Service.getCurrentParams();currentParams.pageSize=pageSize;var newParams=_.assign(currentParams,params);if((newParams.progress==Service.PROGRESS.COMPLETED)&&pageSize==12){newParams.progress=Service.FILTER.GOLIVE;}else if((newParams.progress==Service.FILTER.GOLIVE)&&pageSize==9){newParams.progress=Service.PROGRESS.COMPLETED;}Cache.setCookie(NS,key,JSON.stringify(newParams));return newParams;};function rejectPromise(error){var deferred=$q.defer();var promise=deferred.promise;deferred.reject(error);return promise;}function buildMyCourses(courses){return courses;}function buildMyVideosCount(dialogs){return dialogs;}function buildNewMyVideos(dialogs){if(_.isEmpty(dialogs)){return[];}return dialogs;}function buildMyCoursesCount(course){return course;}function getMyVideosCacheKey(params){if(!params){params={};}var defaultParams={accountID:IdentityAccountService.getIdentity().accountID,page:0,pageSize:6};return _.assign(defaultParams,params);}function getMyVideosCountCacheKey(params){if(!params){params={};}var defaultParams={accountID:IdentityAccountService.getIdentity().accountID};return _.assign(defaultParams,params);}function getMyCoursesCountCacheKey(params){var defaultParams={accountID:IdentityAccountService.getIdentity().accountID};return _.assign(defaultParams,params);}function getMyCoursesPaginationCacheKey(page){var defaultParams={accountID:IdentityAccountService.getIdentity().accountID,coursePage:page||0};var defaultCourseFields=_.clone(DEFAULT_COURSE_FIELDS);return _.assign(defaultCourseFields,defaultParams);}function getMyCoursesCacheKey(params){if(!params){params={};}var defaultParams={accountID:IdentityAccountService.getIdentity().accountID,coursePage:params.coursePage||0};var newCacheParams=_.assign(defaultParams,params);var defaultCourseFields=_.clone(DEFAULT_COURSE_FIELDS);return _.assign(defaultCourseFields,newCacheParams);}function sanitizeMyCoursesParams(params){var newParams=_.clone(params);var filteredParams=_.mapValues(newParams,function(val,key){if(_.isUndefined(newParams[key])||_.isNull(newParams[key])||newParams[key]===''){return DEFAULT_COURSE_FIELDS[key];}return newParams[key];});delete filteredParams.accountID;return _.assign(DEFAULT_COURSE_FIELDS,filteredParams);}return Service;}})(window.angular,window._);";
var mod_pagespeed_RR0qgFHtrF = "(function(window,_,Config){var isFireFox=navigator.userAgent.toLowerCase().indexOf('firefox')>-1;function triggerMobileVideoTracking(category,action,label,dialogID){if(dialogID){openMobileAppDialog(dialogID);}setTimeout(function(){window.angular.element(document).injector().invoke(['Analytics',function(Analytics){Analytics.trackEvent(category,action,label);}]);},500);}function triggerMobileTracking(dialogID){if(dialogID){var label='Content: MobileDownload, DialogID: '+dialogID;}else{var label='Content: MobileDownload';}setTimeout(function(){window.angular.element(document).injector().invoke(['Analytics',function(Analytics){Analytics.trackEvent('Landing','Start',label);}]);},500);}function getUserAgentConfig(dialogId){if(Config.mobile.isIos){return{host:Config.mobile.ios.host,appUrl:dialogId?Config.mobile.ios.dialogIntentUrl:Config.mobile.ios.intentUrl,storeUrl:Config.mobile.ios.storeUrl};}return{host:Config.mobile.android.host,appUrl:dialogId?Config.mobile.android.dialogIntentUrl:Config.mobile.android.intentUrl,storeUrl:Config.mobile.android.storeUrl};}var IOS_DELAY=5000;function openDefaultUrl(url,storeUrl){window.location=url;if(storeUrl){setTimeout(function(){window.location=storeUrl;},IOS_DELAY);}}function openSkypeUrl(url,storeUrl){window.location=url;if(Config.mobile.isIos){var skypeStore='https://itunes.apple.com/app/skype/id304878510?ls=1&mt=8';}else if(Config.mobile.isAndroid){var skypeStore='market://details?id=com.skype.raider';}if(storeUrl){setTimeout(openDefaultUrl(storeUrl,skypeStore),IOS_DELAY);}}function openFireFoxUrl(url,storeUrl){window.location=storeUrl;}function openMobileApp(url,fallback){var userAgentConfig=getUserAgentConfig();if(!userAgentConfig.appUrl){return;}if(fallback){var openUrl=isFireFox?openFireFoxUrl:openSkypeUrl;var appUrl=userAgentConfig.appUrl;var newUrl=appUrl.split('S.browser_fallback_url');newUrl=newUrl[0]+';end';openUrl(newUrl.replace('[HOST]',userAgentConfig.host||window.location.host).replace('[URL]',url||window.location.pathname).replace('[QUERY_PARAMETER]',window.location.search),fallback);}else{console.log(111,userAgentConfig.appUrl.replace('[HOST]',userAgentConfig.host||window.location.host).replace('[URL]',url||window.location.pathname).replace('[QUERY_PARAMETER]',window.location.search),userAgentConfig.storeUrl);var openUrl=isFireFox?openFireFoxUrl:openDefaultUrl;openUrl(userAgentConfig.appUrl.replace('[HOST]',userAgentConfig.host||window.location.host).replace('[URL]',url||window.location.pathname).replace('[QUERY_PARAMETER]',window.location.search),userAgentConfig.storeUrl);}}function trackMobileDownload(OSType){if(!OSType){return false;}triggerMobileTracking();setTimeout(function(){window.angular.element(document).injector().invoke(['Analytics',function(Analytics){Analytics.trackEvent('Landing','Confirm','Content: MobileDownload, OSType: '+OSType);}]);},100);}function openMobileAppDialog(dialogId,fallback){var userAgentConfig=getUserAgentConfig(dialogId);if(!userAgentConfig.appUrl){return;}if(!fallback){fallback=userAgentConfig.storeUrl;}else{var userAgent=userAgentConfig.appUrl.split(\"browser_fallback_url\");userAgentConfig.appUrl=userAgent[0]+'browser_fallback_url='+fallback+';end;';}var openUrl=isFireFox?openFireFoxUrl:openDefaultUrl;openUrl(userAgentConfig.appUrl.replace('[HOST]',userAgentConfig.host||window.location.host).replace('[URL]','').replace('[DIALOG_ID]',dialogId||'').replace('[QUERY_PARAMETER]',window.location.search),fallback);if(Config.mobile.isIos){var OSType='iOS';}else if(Config.mobile.isAndroid){var OSType='Android';}trackMobileDownload(OSType);}_.mixin({'openSkypeUrl':openSkypeUrl,'openMobileApp':openMobileApp,'openMobileAppDialog':openMobileAppDialog,'triggerMobileTracking':triggerMobileTracking,'triggerMobileVideoTracking':triggerMobileVideoTracking});})(window,_,EC_CONFIG);";
var mod_pagespeed_Ylef81CkVw = "angular.module('EnglishCentralApp').directive('ecVideoThumbnail',['EC_CONFIG','$compile','Mediator','IdentityAccountService','Analytics',function(Config,$compile,Mediator,IdentityAccountService,Analytics){var seriesframe=true;return{templateUrl:'video-thumbnail.html',restrict:'A',scope:{hidePlay:'=',hideFavoriting:'=',hideAddedTag:'=',hideAddClassOption:'=',dialogUrl:'@',isRedirect:'@',dialog:\"=ecVideoThumbnail\"},link:function(scope,element,attrs){var features=(!_.isUndefined(attrs.disabled))?attrs.disabled.split(' '):[];var addedTag=element.find('.added-dialog');var addClassIcon=element.find('.add-class-container');scope.isDisplayThumbOptions=false;function getDifficultyIcon(){if(!scope.dialog||!scope.dialog.difficulty){return'';}var difficulty=scope.dialog.difficulty;var THRESHOLD_ADVANCED=4;var THRESHOLD_INTERMEDIATE=2;var difficultyIconClass='ec-difficulty-beginner';if(difficulty>THRESHOLD_ADVANCED){difficultyIconClass='ec-difficulty-advanced';text=Config.translations.difficulties.advanced;}else if(difficulty>THRESHOLD_INTERMEDIATE){difficultyIconClass='ec-difficulty-intermediate';}return difficultyIconClass;}function isRedirect(){var isRedirect=scope.$eval(scope.isRedirect);return _.isEqual(isRedirect,true);}scope.getDialogUrl=function(){if(scope.dialogUrl){return scope.dialogUrl;}else if(scope.dialog&&scope.dialog.dialogID){if(isRedirect()){return'/video/'+scope.dialog.dialogID;}else{return IdentityAccountService.hasIdentity()?'/video/'+scope.dialog.dialogID:'#anonymous-player';}}};scope.hasGrade=false;scope.difficultyIconClass=getDifficultyIcon();scope.isLevelBeginner=function(difficulty){var BEGINNER_START=1,BEGINNER_END=2;return difficulty>=BEGINNER_START&&difficulty<=BEGINNER_END;};scope.isLevelIntermediate=function(difficulty){var INTERMEDIATE_START=3,INTERMEDIATE_END=4;return difficulty>=INTERMEDIATE_START&&difficulty<=INTERMEDIATE_END;};scope.isLevelAdvanced=function(difficulty){var ADVANCED_START=5,ADVANCED_END=7;return difficulty>=ADVANCED_START&&difficulty<=ADVANCED_END;};scope.hasIdentity=IdentityAccountService.hasIdentity();scope.identity=IdentityAccountService.getIdentity();scope.isSeries=function(){return scope.dialog&&scope.dialog.seriesID;};function getEventNamespace(){var nameSpace=attrs.eventNamespace||'BrowseEvents.VIEW_VIDEO';return Analytics.getNamespaceEvent(nameSpace);}scope.showPlayer=function(dialogId){var event=getEventNamespace();event.label='DialogID: '+dialogId;if(IdentityAccountService.hasIdentity()){if(attrs.starterVideos){trackStarterVideo(dialogId);return;}Analytics.storeTrackEvent(event.category,event.action,event.label);return;}Analytics.trackEvent(event.category,event.action,event.label);if(isRedirect()){return false;}Mediator.publish('Player.SETMODAL','ecVideoThumbnail',dialogId);Mediator.publish('Player.RESET','ecVideoThumbnail',dialogId);Mediator.publish('Player.PAUSE','ecVideoThumbnail',dialogId);Mediator.publish('playerModal','ecVideoThumbnail',dialogId);var unsub=Mediator.subscribe('Player.LOADED','ecVideoThumbnail',function(data){if(dialogId==data){var ns='Player.'+dialogId;Mediator.publish(ns+'.TRIGGERPLAY','ecVideoThumbnail',dialogId);unsub();}});};function trackStarterVideo(dialogId){var event=Analytics.getNamespaceEvent('MyEnglishEvents.VIEW_STARTER_VIDEO');event.label='DialogID: '+dialogId+' | Location: StarterVideo';Analytics.storeTrackEvent(event.category,event.action,event.label);}scope.isEnabled=function(feature){return(_.indexOf(features,feature)==-1);};seriesframe=(attrs.seriesframe===undefined)?seriesframe:scope.$eval(attrs.seriesframe);if(scope.dialog&&scope.dialog.seriesID&&seriesframe){angular.element(element[0].querySelector('.series-bg')).removeClass('hidden');element.addClass('series-thumbnail');}if(!angular.isUndefined(scope.dialog)&&!angular.isUndefined(scope.dialog.progress)&&!angular.isNumber(scope.dialog.progress.grade)&&!angular.isUndefined(scope.dialog.progress.grade)&&angular.isString(scope.dialog.progress.grade)){scope.hasGrade=true;}scope.hasIdentity=IdentityAccountService.hasIdentity();scope.identity=IdentityAccountService.getIdentity();IdentityAccountService.subscribeIdentityUpdate('ecVideoThumbnail',function(){scope.hasIdentity=IdentityAccountService.hasIdentity();scope.identity=IdentityAccountService.getIdentity();});scope.viewDialog=function(dialogId){trackDialogEvent(dialogId);window.location=\"/video/\"+dialogId;};element.on('mouseenter',function(e){scope.$apply(function(){scope.isDisplayThumbOptions=true;});e.stopPropagation();addedTag.hide();addClassIcon.addClass('visible');});element.on('mouseleave',function(){scope.$applyAsync(function(){scope.isDisplayThumbOptions=false;});addedTag.show();addClassIcon.removeClass('visible');});}}}]).directive('ecFavorite',['ActivityEventService','Mediator','MyEnglishService','ReportCardActivityDialogService',function(ActivityEventService,Mediator,MyEnglishService,ReportCardActivityDialogService){return{scope:{dialog:'=ecFavorite'},restrict:'A',link:function(scope,element,attrs){if(!scope.dialog){return;}var dialog=scope.dialog;var isFavorite=false;scope.isFavorating=false;function getDialogFavoriteStatus(){if(_.isUndefined(dialog.progress)){return false;}return dialog.progress.favorite;}function setActive(){if(element.hasClass('on')){element.removeClass('on');}else{element.addClass('on');}}scope.$watch('dialog.progress',function(progress){if(progress&&progress.favorite){element.addClass('on');}isFavorite=getDialogFavoriteStatus();});element.on('click',function(event){MyEnglishService.deleteMyVideosCache();ReportCardActivityDialogService.deleteCache(dialog.dialogID);var markAsFavorite=!isFavorite;ActivityEventService.setDialogAsFavorite(dialog.dialogID,markAsFavorite).then(function(){isFavorite=markAsFavorite;Mediator.publish('ecFavorite.FAVORITED','ecVideoThumbnail',isFavorite);setActive();});event.preventDefault();});}}}]).filter('duration',function(){return function(duration){if(!angular.isUndefined(duration)){return duration.substr(3,5);}else{return'';}}});";
var mod_pagespeed_BFE9GUVV6H = "(function(window,angular,_){angular.module('EnglishCentralApp').directive('ecProgress',['EC_CONFIG',ecProgress]);function ecProgress(Config){function activityprogress(activity){var activityCounter=0,completedCounter=0,progress;angular.forEach(activity,function(act){if(typeof act.children!='undefined'&&act.children.length>0){progress=activityprogress(act.children);activityCounter+=progress.count;completedCounter+=progress.completed;}else if(typeof act.completed!='undefined'){activityCounter+=1;completedCounter+=(act.completed?1:0);}});return{count:activityCounter,completed:completedCounter};}var CSS_COMPLETED='completed';var CSS_STARTED='started';var CSS_NO_PROGRESS='';var validDialogActivityTypesIds={watch:9,learn:10,speak:11};var evalDialogProgress=function(progress){if(_.isEmpty(progress)||!'activities'in progress){return CSS_NO_PROGRESS;}if('progress'in progress){if(progress>=1){return CSS_COMPLETED;}else if(progress>0){return CSS_STARTED;}else{return CSS_NO_PROGRESS;}}var validDialogActivities=_.filter(progress.activities,function(activity){return _.includes(validDialogActivityTypesIds,activity.activityTypeID);});var progressStatus=_.reduce(validDialogActivities,function(acc,activity){if(acc.completed&&!activity.completed){acc.completed=false;}if(!acc.started&&activity.started){acc.started=true;}return acc;},{started:false,completed:true});if(progressStatus.completed&&!_.isEmpty(validDialogActivities)){return CSS_COMPLETED;}else if(progressStatus.started){return CSS_STARTED;}return CSS_NO_PROGRESS;};var initDialogProgress=function(element,type,progress){switch(type){case'dialog':element.addClass(evalDialogProgress(progress));break;case'course':if(progress){_.isEqual(progress,0)?element.hide():element.show();element.html(progress+'%<br/><span class=\"complete-text\">'+Config.translations.courseThumbnail.complete+'</span>');}break;default:break;}};return{scope:{progressData:'=ecProgress'},restrict:'A',link:function(scope,element,attrs){if(!Config.hasIdentity){return false;}var type=attrs.type;var id=attrs.id;scope.$watch('progressData',function(progress){initDialogProgress(element,type,progress);});if(scope.progressData){initDialogProgress(element,type,scope.progressData);}}};}})(window,window.angular,window._);";
var mod_pagespeed_nBTj57E4YN = "angular.module('EnglishCentralApp').directive('ecCourseThumbnail',['EC_CONFIG','Analytics','IdentityAccountService',function(Config,Analytics,IdentityAccountService){return{templateUrl:'course-thumbnail.html',restrict:'A',scope:{course:'=ecCourseThumbnail',hideAddedTag:'=',hideAddClassOption:'='},link:function(scope,element,attrs){var addClassIcon=element.find('.add-class-container');scope.difficultyIconClass=getDifficultyIcon();function getDifficultyIcon(){var difficulty=scope.course.difficulty;var THRESHOLD_ADVANCED=4;var THRESHOLD_INTERMEDIATE=2;var difficultyIconClass='ec-difficulty-beginner';if(difficulty>THRESHOLD_ADVANCED){difficultyIconClass='ec-difficulty-advanced';text=Config.translations.difficulties.advanced;}else if(difficulty>THRESHOLD_INTERMEDIATE){difficultyIconClass='ec-difficulty-intermediate';}return difficultyIconClass;}if(scope.course.dialogCount){if(scope.course.dialogCount>1){scope.course.courseDialogCount=scope.course.dialogCount+\" \"+Config.translations.courseThumbnail.videos;}else{scope.course.courseDialogCount=scope.course.dialogCount+\" \"+Config.translations.courseThumbnail.video;}}if(scope.course.cliplistCount){if(scope.course.cliplistCount>1){scope.course.courseCliplistCount=scope.course.cliplistCount+\" \"+Config.translations.courseThumbnail.cliplists;}else{scope.course.courseCliplistCount=scope.course.cliplistCount+\" \"+Config.translations.courseThumbnail.cliplist;}}if(scope.course.unitCount){if((scope.course.unitCount>1||scope.course.unitCount==0)){scope.course.courseUnitCount=scope.course.unitCount+\" \"+Config.translations.courseThumbnail.units;}else{scope.course.courseUnitCount=scope.course.unitCount+\" \"+Config.translations.courseThumbnail.unit;}}function getEventNamespace(){var namespace=attrs.eventNamespace||'BrowseEvents.VIEW_COURSE';return Analytics.getNamespaceEvent(namespace);}scope.viewCourse=function(courseId){var event=getEventNamespace();event.label='CourseID: '+courseId;event.value=_.getTimestamp();Analytics.trackEvent(event.category,event.action,event.label,event.value);window.location=\"/courses/preview/\"+courseId;};scope.isLevelBeginner=function(difficulty){var BEGINNER_START=1,BEGINNER_END=2;return difficulty>=BEGINNER_START&&difficulty<=BEGINNER_END;};scope.isLevelIntermediate=function(difficulty){var INTERMEDIATE_START=3,INTERMEDIATE_END=4;return difficulty>=INTERMEDIATE_START&&difficulty<=INTERMEDIATE_END;};scope.isLevelAdvanced=function(difficulty){var ADVANCED_START=5,ADVANCED_END=7;return difficulty>=ADVANCED_START&&difficulty<=ADVANCED_END;};scope.hasIdentity=IdentityAccountService.hasIdentity();scope.identity=IdentityAccountService.getIdentity();IdentityAccountService.subscribeIdentityUpdate('ecCourseThumbnail',function(){scope.hasIdentity=IdentityAccountService.hasIdentity();scope.identity=scope.identity;});element.on('mouseenter',function(e){e.stopPropagation();addClassIcon.addClass('visible');});element.on('mouseleave',function(e){e.stopPropagation();addClassIcon.removeClass('visible');});}}}]).directive('ecCourseHover',['EC_CONFIG',function(Config){return{templateUrl:'course-hover.html',replace:true,restrict:'A',link:function(scope,element,attrs){$(element).hide();$(element).parents('a').on('mouseenter',function(){$(element).show();}).on('mouseleave',function(){$(element).hide();});scope.contentHeader=Config.translations.courseHover.header;scope.contentNote=Config.translations.courseHover.note;scope.contentLink=Config.translations.courseHover.link;}}}]);";
var mod_pagespeed_rodv$UIKKc = ";(function(angular,_){angular.module('EnglishCentralApp').factory('LoaderService',[LoaderService]);function LoaderService(){var Service={};var appNameSpaces={};function Loader(){var loaders=[];var self=this;this.start=function(item){var loader=_.find(loaders,{id:item});if(!loader){loader={id:item,value:true}\nloaders.push(loader);}loader.value=true;};this.done=function(item){var loader=_.find(loaders,{id:item});if(loader){loader.value=false;}};this.isLoading=function(item){var loader=_.chain(loaders).filter(function(load){return _.isEqual(load.value,true);}).first().value()||{};return _.isEqual(loader.id,item);};this.isLoaded=function(){var loadedItemCount=_.filter(loaders,function(load){return _.isEqual(load.value,true);}).length;return _.isEqual(loadedItemCount,0)};this.getItems=function(){return loaders;};}Service.initialize=function(NS){if(_.isUndefined(appNameSpaces[NS])){appNameSpaces[NS]=new Loader();}return appNameSpaces[NS];};return Service;}}(window.angular,window._));";
var mod_pagespeed_7Wp7hJ2ERn = "angular.module('EnglishCentralApp').service('SkypeValidator',['EC_CONFIG',function(Config){var ERROR_MESSAGE=Config.translations.validationMessages;var PASSWORD_MINLENGTH=6;var PASSWORD_MAXLENGTH=32;var Service={};Service.isValid=function(value){if(_.isEmpty(value)||_.isUndefined(value)){return ERROR_MESSAGE.skype.required;}if(value.length<PASSWORD_MINLENGTH){return ERROR_MESSAGE.skype.minlength;}if(value.length>PASSWORD_MAXLENGTH){return ERROR_MESSAGE.skype.maxlength;}if(!_.skypePattern().test(value)){return ERROR_MESSAGE.skype.pattern;}return true;};return Service;}]);";
var mod_pagespeed_4JhgthZ3pe = "(function(_){var SKYPEID_REGEX=/^[A-Za-z][A-Za-z0-9.,-_]*$/;function skypePattern(){return SKYPEID_REGEX;}_.mixin({\"skypePattern\":skypePattern});})(_);";
var mod_pagespeed_xmPgbnM$4U = "(function(angular){angular.module('EnglishCentralApp').factory('TutorTutorService',['$q','IdentityAccountService','LocalCacheService','ConnectionFactory','TutorTutorModel',TutorTutorService]);angular.module('EnglishCentralApp').factory('TutorTutorModel',['EC_CONFIG',TutorTutorModel]);function TutorTutorService($q,IdentityAccountService,Cache,ConnectionFactory,TutorTutorModel){var NAMESPACE='TutorTutorService';var NAMESPACE_RECOMMENDATION=NAMESPACE+'Recommendation';var NAMESPACE_RECOMMENDATION_COUNT=NAMESPACE+'RecommendationCount';var Service={};var TutorREST=ConnectionFactory.get('tutor').one('tutor');Service.getTutorStudent=function(accountID,params){if(!IdentityAccountService.hasIdentity()){return rejectPromise('Anonymous');}if(!_.isObject(params)){params={};}var generate=function(){return TutorREST.one('student',accountID).get(params).then(function(response){return response.data;},rejectPromise);};return Cache.getPromise(NAMESPACE,params,generate,null,ConnectionFactory.getCacheExpiration('tutor'));};Service.getTutors=function(params){if(!_.isObject(params)){params={};}var generate=function(){return TutorREST.get(params).then(function(response){return response.data;},rejectPromise);};return Cache.getPromise(NAMESPACE,params,generate,null,ConnectionFactory.getCacheExpiration('tutor'));};Service.getRecommendation=function(params){if(!_.isObject(params)){params={};}var generate=function(){return TutorREST.one('recommendation').get(params).then(function(response){return response.data;});};var build=function(tutors){return _.map(tutors,function(tutor){return TutorTutorModel.build(tutor);});};return Cache.getPromise(NAMESPACE_RECOMMENDATION,generateTutorCacheKey(params),generate,build,ConnectionFactory.getCacheExpiration('tutor'));};Service.getRecommendationCount=function(params){if(!_.isObject(params)){params={};}var generate=function(){return TutorREST.one('recommendation','count').get(params).then(function(response){return response.data;});};return Cache.getPromise(NAMESPACE_RECOMMENDATION_COUNT,params,generate,null,ConnectionFactory.getCacheExpiration('tutor'));};Service.deleteTutorCache=function(){Cache.removeLocalCacheNamespace(NAMESPACE);Cache.removeLocalCacheNamespace(NAMESPACE_RECOMMENDATION);};function rejectPromise(error){var deferred=$q.defer();var promise=deferred.promise;deferred.reject(error);return promise;}function generateTutorCacheKey(params){var identity=IdentityAccountService.getIdentity();return{accountID:identity.accountID,startRange:params.startDate,endRange:params.endDate,maxRecommendationCount:params.maxRecommendationCount,offerType:params.offerType};}return Service;}function TutorTutorModel(Config){var Service={};var delimiter=Config.delimiters.comma;function TutorTutor(data){_.assign(this,data);var profile=this.profile;if(profile){if(!_.isEmpty(profile.favoriteReadings)){this.displayFavoriteReadings=_.map(profile.favoriteReadings,function(data){return data.answer?data.answer:data.supplementaryStringValue;}).join(delimiter);}if(!_.isEmpty(profile.major)){this.displayMajors=_.map(profile.major,function(data){return data.answer?data.answer:data.demographicValue;}).join(delimiter);}if(!_.isEmpty(profile.topics)){this.displayTopics=_.map(profile.topics,function(data){return data.answer?data.answer:data.demographicValue;}).join(delimiter);}if(!_.isEmpty(profile.teachingStyle)){this.displayTeachingStyles=_.map(profile.teachingStyle,function(data){return data.answer?data.answer:data.supplementaryStringValue;}).join(delimiter);}if(!_.isEmpty(profile.tutorLevel)){this.displayTutorLevel=_.map(profile.tutorLevel,function(data){return data.demographicValue}).join(delimiter);}if(!_.isEmpty(profile.specialSkills)){this.displaySpecialSkills=_.map(profile.specialSkills,function(data){return data.answer?data.answer:data.supplementaryStringValue}).join(delimiter);}}}Service.build=function(data){return new TutorTutor(data);};return Service;}})(window.angular);";
var mod_pagespeed_BASZoHTZeN = "(function(angular){angular.module('EnglishCentralApp').service('VideoModalService',['$modal','$modalStack',VideoModalService]);function VideoModalService($modal,$modalStack){var Service={};Service.openLeveltestIntro=function(params){params=params||{};return $modal.open({templateUrl:'leveltest-intro-modal.html',controller:'IntroVideoModalController',controllerAs:'leveltestIntro',backdrop:true,size:'lg',windowClass:'leveltest-intro-modal',resolve:{video:function(){return params;}}});};Service.closeLevelTestIntro=function(){$modalStack.dismissAll();};Service.openECIntro=function(params){params=params||{};return $modal.open({templateUrl:'ec-intro-modal.html',controller:'IntroVideoModalController',controllerAs:'ecIntro',backdrop:'static',size:'lg',windowClass:'ec-intro-modal',resolve:{video:function(){return params;}}});};Service.openGoliveIntro=function(params){params=params||{};return $modal.open({templateUrl:'golive-intro-modal.html',controller:'IntroVideoModalController',controllerAs:'goliveIntro',size:'lg',windowClass:'golive-intro-modal',resolve:{video:function(){return params;}}});};Service.openGenericVideo=function(params){params=params||{};var getClass=function(){if(params.windowClass){return'generic-video-modal'+' '+params.windowClass;}return'generic-video-modal';};return $modal.open({templateUrl:'generic-video-modal.html',controller:'IntroVideoModalController',controllerAs:'genericVideo',size:params.size||'lg',windowClass:getClass(),resolve:{video:function(){return params;}}});};return Service;}})(angular);";
var mod_pagespeed_bGoklDyYGN = "(function(angular){angular.module('EnglishCentralApp').controller('IntroVideoModalController',['$scope','$modalInstance','video',IntroVideoModalController]);function IntroVideoModalController($scope,$modalInstance,video){$scope.video=!_.isUndefined(video)?video:[];$scope.close=function(event){if(_.isFunction(event)){event();}$modalInstance.close();}}}(window.angular));";
var mod_pagespeed_is86XVzXwT = "(function(angular){angular.module('EnglishCentralApp').factory('TutorFavoriteService',['$q','LocalCacheService','ConnectionFactory','IdentityAccountService',TutorFavoriteService]);function TutorFavoriteService($q,Cache,ConnectionFactory,IdentityAccountService){var NAMESPACE='TutorFavoriteService';var Service={};var FavoriteREST=ConnectionFactory.get('tutor').one('tutor','student').one('favorite');function rejectPromise(error){var deferred=$q.defer();var promise=deferred.promise;deferred.reject(error);return promise;}Service.get=function(reportID){};Service.post=function(params){if(IdentityAccountService.hasIdentity()){rejectPromise(\"Anonymous not allowed\");}if(_.isEmpty(params)||!_.isObject(params)){rejectPromise(\"Invalid params\");}return FavoriteREST.post(null,{},params);};Service.put=function(params){if(!IdentityAccountService.hasIdentity()){rejectPromise(\"Anonymous not allowed\");}if(_.isEmpty(params)||!_.isObject(params)){rejectPromise(\"Invalid params\");}return FavoriteREST.put(params);};return Service;}})(window.angular);";
var mod_pagespeed_XWIJhZgPXf = "(function(angular,_){angular.module('EnglishCentralApp').directive('ecImageOnError',[ecImageOnError]);function ecImageOnError(){return{scope:{ecImageOnError:'='},link:function(scope,element,attr){element.on('error',function(){element.attr('src',scope.ecImageOnError);})}}}}(window.angular,window._));";
var mod_pagespeed_ajEEjVqn68 = "(function(angular,_){angular.module('EnglishCentralApp').directive('ecTutorThumbnail',['EC_CONFIG','Mediator','TutorFavoriteService','IdentityAccountService',ecTutorThumbnail]);function ecTutorThumbnail(Config,Mediator,TutorFavoriteService,IdentityAccountService){return{templateUrl:'tutor-thumbnail.html',restrict:'A',scope:{ecTutorThumbnail:'=',tutorFavoritingEnabled:'=',tutorStatusEnabled:'=',tutorLevelEnabled:'=',tutorInfoEnabled:'=',tutorUseProfilePhoto:'=',tutorCustomImageUrl:'=',tutorHeight:'@',tutorWidth:'@'},link:function(scope,element,attrs){var identity=IdentityAccountService.getIdentity();var tutorImageUrl;scope.isFavoritingEnabled=!_.isUndefined(scope.tutorFavoritingEnabled)?scope.tutorFavoritingEnabled:false;scope.isStatusEnabled=!_.isUndefined(scope.tutorStatusEnabled)?scope.tutorStatusEnabled:false;scope.isLevelEnabled=!_.isUndefined(scope.tutorLevelEnabled)?scope.tutorLevelEnabled:false;scope.isInfoEnabled=!_.isUndefined(scope.tutorInfoEnabled)?scope.tutorInfoEnabled:false;scope.height=!_.isUndefined(scope.tutorHeight)?scope.tutorHeight:'300px';scope.width=!_.isUndefined(scope.tutorWidth)?scope.tutorWidth:'250px';scope.tutor=scope.ecTutorThumbnail||{};scope.isFavorited=scope.tutor.isFavorited;scope.isFavoratingLoading=false;scope.$watch('ecTutorThumbnail',function(value){if(value){scope.tutor=value;tutorImageUrl=scope.tutor.profilePictureUrl?scope.tutor.profilePictureUrl:scope.tutor.avatarURL;if(scope.tutorUseProfilePhoto){tutorImageUrl=scope.tutor.profilePictureUrl?scope.tutor.profilePictureUrl:scope.tutor.avatarURL;}if(scope.tutorCustomImageUrl){tutorImageUrl=scope.tutorCustomImageUrl;}scope.tutorImageUrl=tutorImageUrl?tutorImageUrl:'/images/ec3.4/common/tutor-default-avatar.png';scope.isFavorited=scope.tutor.isFavorited;}});scope.favorite=function(){var params={studentAccountID:identity.accountID,tutorAccountID:scope.tutor.tutorAccountID};scope.isFavoratingLoading=true;TutorFavoriteService.post(params).then(function(){scope.isFavoratingLoading=false;Mediator.publish('TUTOR.FAVORITED','ecTutorThumbnail',true);scope.isFavorited=true;});};scope.unfavorite=function(){var params={studentAccountID:identity.accountID,tutorAccountID:scope.tutor.tutorAccountID};scope.isFavoratingLoading=true;TutorFavoriteService.put(params).then(function(){scope.isFavoratingLoading=false;Mediator.publish('TUTOR.FAVORITED','ecTutorThumbnail',false);scope.isFavorited=false;});};}};}}(window.angular,window._));";
var mod_pagespeed_T5cw6OCjy7 = "(function(angular,_){angular.module('EnglishCentralApp').factory('OutageService',['$q','EC_CONFIG','LocalCacheService','ConnectionFactory',OutageService]);function OutageService($q,Config,Cache,ConnectionFactory){var OutageREST=ConnectionFactory.get('tutor').one('outage');var Service={};var rejectPromise=function(error){var deferred=$q.defer();var promise=deferred.promise;deferred.reject(error);return promise;};Service.getAllMessages=function(params){var generate=function(){return OutageREST.get(params);};return Cache.getPromise('OutageMessages',params,generate,null,ConnectionFactory.getCacheExpiration('outage'));};Service.getAllMessagesCount=function(){var startDate=_.toBsonDateFormat(moment().utc());var endDate=_.toBsonDateFormat(moment().add(14,'day').utc());var params={sessionOutageStartDate:startDate,sessionOutageEndDate:endDate,active:true};var generate=function(){return OutageREST.one('count').get(params);};return Cache.getPromise('OutageMessagesCount',params,generate,null,ConnectionFactory.getCacheExpiration('outage'));};Service.deleteOutageCache=function(params){Cache.remove('OutageMessages',params);Cache.removeMemory('OutageMessages',params);Cache.remove('OutageMessagesCount',params);Cache.removeMemory('OutageMessagesCount',params);};return Service;}})(window.angular,window._);";
var mod_pagespeed_pM8qOfaVZe = "angular.module('EnglishCentralApp').directive('outageMessages',['$modal','Mediator','LanguageConstants','OutageService','IdentityAccountService',function($modal,Mediator,LanguageConstants,OutageService,IdentityAccountService){return{scope:true,restrict:'A',templateUrl:'outage-messages.html',controller:[function(){var self=this;var STATUS_ENDED='Ended';var STATUS_ONGOING='Ongoing';var STATUS_UPCOMING='Upcoming';self.identity=IdentityAccountService.getIdentity();self.showMessage=false;this.initialize=function(){var startDate=_.toBsonDateFormat(moment().utc());var endDate=_.toBsonDateFormat(moment().add(14,'day').utc());var params={sessionOutageStartDate:startDate,sessionOutageEndDate:endDate,active:true};OutageService.getAllMessages(params).then(function(messages){self.messages=messages;self.messages=_.sortBy(self.messages,'sessionOutageStartDate');_.map(self.messages,function(message){message.sessionOutageStartDateNew=getDisplayScheduleFormat(message.sessionOutageStartDate,self.identity,IdentityAccountService.getTimezone());message.sessionOutageEndDateNew=getDisplayScheduleFormat(message.sessionOutageEndDate,self.identity,IdentityAccountService.getTimezone());});});};function getDisplayScheduleFormat(data,identity,timezone){var locale;if(!identity||!identity.siteLanguage){locale=TimeslotConstants.DEFAULT_LOCALE;}else if(identity.siteLanguage==LanguageConstants.CHINESE){locale=LanguageConstants.CHINESE_SIMPLIFIED;}else{locale=identity.siteLanguage;}return moment.tz(data,timezone).locale(locale).format('MMM DD, HH:mm');}function getStatus(outage){var currentDate=moment(new Date());var startDate=moment(outage.sessionOutageStartDate);var endDate=moment(outage.sessionOutageEndDate);if(outage.active&&(startDate<currentDate&&endDate<currentDate)){return STATUS_ENDED;}if(outage.active&&(startDate>currentDate&&endDate>currentDate)){return STATUS_UPCOMING;}if(outage.active&&(startDate<currentDate&&endDate>currentDate)){return STATUS_ONGOING;}};Mediator.subscribe('SessionController.CHANGE_TIMEZONE','outageMessages',function(data){_.map(self.messages,function(message){message.sessionOutageStartDateNew=getDisplayScheduleFormat(message.sessionOutageStartDate,self.identity,data);message.sessionOutageEndDateNew=getDisplayScheduleFormat(message.sessionOutageEndDate,self.identity,data);});});this.showMessages=function(){self.showMessage=!self.showMessage;};}],controllerAs:'outage',link:function(scope,elem,attrs){scope.outage.initialize();}};}]);";
var mod_pagespeed_UeYzFUDuRC = "(function(angular){function ecSessionApplet(Config,Analytics){return{controller:\"SessionController\",controllerAs:\"sessionApp\",replace:true,templateUrl:\"session.html\",link:function(scope,elem,attr){var sessionApp=scope.sessionApp;attr.$addClass(sessionApp.type.toLowerCase());angular.element('#leveltest-modal').on('hide.bs.modal',function(){if(!_.isEmpty(sessionApp.session)&&!sessionApp.session.isMissed){sessionApp.showConfirmation();}});sessionApp.redirectTo=attr.redirectTo;sessionApp.closeOnSchedule=scope.$eval(attr.closeOnSchedule);sessionApp.skip=function(){if(Config.lang=='ko'){Analytics.trackEvent('LevelTest','SkipLT','SkipLT',_.getTimestamp());}};}};}angular.module('EnglishCentralApp').directive('ecSessionApplet',['EC_CONFIG','Analytics',ecSessionApplet])})(angular);";
var mod_pagespeed_ud_t6lWdop = "(function(window,angular,_){angular.module('EnglishCentralApp').controller('SessionController',['$scope','$attrs','$location','SessionAppService','EC_CONFIG','Mediator','IdentityAccountService','LocalCacheService','TutorTimeslotConstants','SessionConstants','Analytics','TimezoneService','SessionModalService','ecScrollSpyService','$timeout','SkypeValidator','TutorTutorService','TutorSessionService','TutorTimeslotService','ContactInformationService','LoaderService','OutageService',SessionController]);function SessionController($scope,$attr,$location,SessionAppService,Config,Mediator,IdentityAccountService,Cache,TimeslotConstants,SessionConstants,Analytics,TimezoneService,SessionModalService,ecScrollSpyService,$timeout,SkypeValidator,TutorTutorService,TutorSessionService,TutorTimeslotService,ContactInformationService,LoaderService,OutageService){var NS='SessionController';var LANGUAGE_JA='ja';var self=this;var _initSkypeID='';var _contact={};var _identity=IdentityAccountService.getIdentity();var DISPLAY_DATE_COUNT=3;var DEFAULT_AVAILABLEONLY='true';self.loaderSkype=LoaderService.initialize('Skype');self.type=$attr['type'];self.mode=_.isEmpty($attr['mode'])?'default':$attr['mode'];self.subscriber='SessionController.'+self.type+'.'+self.mode;self.source='SessionController.'+$scope.$id;self.viewtype=_.isEmpty($attr['viewtype'])?'default':$attr['viewtype'];self.skypeNamespace=_buildFieldNS('skype');self.phoneNamespace=_buildFieldNS('phone');self.sessionscheduleNamespace=_buildFieldNS('sessionschedule');self.dayIndex=0;self.skypePattern=_.skypePattern();self.isModal=self.mode=='modal';self.isRefreshTimeslot=false;self.tutorDropdownChanged=false;self.startTimeAnalytics=new Date().getTime();self.endTimeAnalytics=new Date().getTime();self.startTimeslotAnalytics=new Date().getTime();self.endTimeslotAnalytics=new Date().getTime();self.tutorFromBookAgain={};self.isFormToggled=true;var _events=Analytics.getEvents('SessionEvents');var _context=['SessionType: '+self.type];if(self.isModal){_context.push('Context: Modal');}else{if(Config.currentController!='myenglish'){_context.push('Context: '+self.type+' Widget');}else{ecScrollSpyService.subscribe(function(event){if(event=='leveltest-app'){var _events=Analytics.getEvents('SessionEvents');var _context=['Session: LT','Context: MyEnglish'];_events=Analytics.setContext(Analytics.buildContext(_context),_events);Analytics.trackEvent(_events.FORM_SEEN.category,_events.FORM_SEEN.action,_events.FORM_SEEN.label);}});}}_events=Analytics.setContext(Analytics.buildContext(_context),_events);self.events=_events;self.isLevelTest=self.type.match(/lt|leveltest/i)?true:false;self.isGoLive=self.type.match(/gl|golive/i)?true:false;self.isLevelUpTest=self.type.match(/lut|leveluptest/i)?true:false;self.isAdvertising=Config.site.isAdvertising?true:false;self.isBrowse=Config.site.isBrowse?true:false;self.appInstance=SessionAppService;self.hasTimeslots=false;self.isConfirmation=false;self.isForm=false;self.isReschedule=false;self.isError=false;self.isLoading=true;self.showEditSkype=(Config.lang!='ko');self.editSkype=false;self.errorMessage='';self.loadingMessage='';self.timezoneEnabled=TimezoneService.enabled();self.timezones=[];self.timezoneSelector=false;self.timezoneLoading=false;setTimezoneList();_getTutorStudent();function setTimezoneList(){if(!TimezoneService.enabled()){return false;}var tzName=IdentityAccountService.getTimezone(true);self.selectedTimezone=TimezoneService.getByName(tzName);TimezoneService.list().then(function(response){self.timezones=response;});}function _setSession(session){applyAsync(function($scope){$scope.session=session;});$scope.dialog={};if(session&&!_.has(session,'sessionID')&&_.has(_contact,'phoneNumber')){self.session=_.assign(session,_contact)}if(session&&!_.has(session,'sessionID')&&_.has(_contact,'skypeID')){self.session=_.assign(session,_contact)}if(!_.isEmpty(session.dialogGoLive)){$scope.dialog=session.dialogGoLive;self.session.dialogID=$scope.dialog.dialog.dialogID;}if(session.skypeID){self.setEditSkype(false);_initSkypeID=session.skypeID;self.hasSkypeID=true;}}function _setContact(session){if(_.has(self.session,'sessionID')){return false;}if(!_.isEmpty(session)&&(_.has(session,'phone')||_.has(session,'phoneNumber'))){applyAsync(function($scope){if(!_.isEmpty($scope.session)){$scope.session.phoneNumber=session.phoneNumber;}});}if(!_.isEmpty(session)&&_.has(session,'skypeID')){applyAsync(function($scope){if(!_.isEmpty($scope.session)){$scope.session.displaySkypeID=session.displaySkypeID;$scope.session.skypeID=session.skypeID;}});}_contact=session;}function trackTimeslotTiming(){self.endTimeslotAnalytics=new Date().getTime();var roleType=_identity.isBasic?\"Basic\":\"Paying User\";var timeSpent=self.endTimeslotAnalytics-self.startTimeslotAnalytics;Analytics.trackTiming('TutorSession',SessionAppService.timeSlotAnalyticsAction+\" - \"+roleType,timeSpent,Analytics.buildContext([_events.FORM_SEEN.label,'SessionType: '+self.type]));SessionAppService.timeSlotAnalyticsAction=\"timeToSeeTimeslot\";}function _setTimeslot(timeslotList){self.timeslotList=timeslotList;self.hasTimeslots=!_.isEmpty(self.timeslotList);var hasAvailableSchedule=false;angular.forEach(timeslotList[0].hours,function(hours,dayPart){if(!hasAvailableSchedule){angular.forEach(hours,function(value,key){if(value.available){hasAvailableSchedule=true;}});if(!hasAvailableSchedule){delete self.timeslotList[0].hours[dayPart];}}});trackTimeslotTiming();}function _fetchTimeslot(sessionType,fromDate,tutorAccountID,dialogID){self.startTimeslotAnalytics=new Date().getTime();var params={sessionType:sessionType};if(tutorAccountID){params.tutorAccountID=tutorAccountID;}if(dialogID&&self.type=='GL'){params.dialogID=dialogID;}return SessionAppService.getTimeslots(params,self.selectedTimezone.name,fromDate).then(function(timeslots){if(_.isEmpty(timeslots)&&self.type=='GL'&&tutorAccountID){self.selectedTutorFromBookAgainAvailable=false;self.selectedTutor='';_fetchTimeslot(self.type,self.date,null,dialogID);}else{_setTimeslot(timeslots);}return timeslots;});}function _getTutorStudent(){var PAGE_SIZE=5;var params={pageSize:PAGE_SIZE,fields:'shifts',availableOnly:DEFAULT_AVAILABLEONLY,sessionType:[SessionConstants.TYPE_LT,SessionConstants.TYPE_GL].join(',')};if(self.type==SessionConstants.TYPE_GL){params.sessionType=SessionConstants.TYPE_GL;}TutorTutorService.getTutorStudent(_identity.accountID,params).then(function(response){if(!_.isEmpty(response)){self.tutors=response;_.map(self.tutors,function(tutor){if(tutor.tutorAccountID==self.tutorFromBookAgain.tutorAccountID){self.tutorTopFive=true;}});}});}self.toggleSkypeForm=function(){if(self.editSkype){if(_initSkypeID==self.session.skypeID){self.editSkype=!self.editSkype;return;}if(_.isEmpty(self.session.skypeID)){return;}SessionAppService.updateContact(self.session).then(function(updatedSession){if(!_.isEmpty(updatedSession)&&_.has(updatedSession,'sessionID')){self.editSkype=!self.editSkype;}});}else{self.editSkype=!self.editSkype;}};self.showForm=function(fromUI){self.isForm=true;self.isReschedule=false;self.isConfirmation=false;self.timezoneSelector=false;if(fromUI){self.isReschedule=true;}if(self.session){if(self.session.phoneNumber){self.session.phoneNumber=IdentityAccountService.getPhone();}}if(!_.isUndefined(self.session)&&TimezoneService.enabled()){self.session.timezone=IdentityAccountService.getTimezone();var tzSelected=TimezoneService.getByName(self.session.timezone);self.session.timezoneDisplay=tzSelected.display;}if(fromUI||Config.currentController!='myenglish'){Analytics.trackEvent(_events.FORM_SEEN.category,_events.FORM_SEEN.action,_events.FORM_SEEN.label);}SessionModalService.showForm();};self.toggleTimezoneSelector=function(){self.timezoneSelector=true;};self.updateTimezone=function(){if(_.isEmpty(self.selectedTimezone)){return false;}self.timezoneLoading=true;self.timezoneSelector=false;IdentityAccountService.setTimezone(self.selectedTimezone.name);};self.resetTimeslot=function(){self.session.schedule=\"\";self.session.displayLongDate=\"\";self.session.displayShortDateTime=\"\";self.session.displayShortDate=\"\";self.session.displayDayShort=\"\";self.session.displayTime=\"\";};self.updateTimeslot=function(){self.resetTimeslot();self.tutorDropdownChanged=true;var tutorAccountID=null;if(self.selectedTutor){tutorAccountID=self.selectedTutor;}if(!self.session.dialogID&&self.session.sessionType==SessionConstants.TYPE_GL){self.session.dialogID=_dialogID;}_fetchTimeslot(self.type,self.date,tutorAccountID,self.session.dialogID);Mediator.publish(\"SessionController.CHANGE_TIMEZONE\",'SessionController',self.selectedTimezone.name);Analytics.trackEvent(_events.SELECT_TIMEZONE.category,_events.SELECT_TIMEZONE.action,Analytics.buildContext([_events.SELECT_TIMEZONE.label,'Value: '+self.type+' ** '+self.date+' ** '+self.selectedTimezone.name+' ** '+self.selectedTimezone.offset]));};function applyAsync(changeFn){changeFn(self);if(!$scope.$$phase){$scope.$apply(function($scope){changeFn(self);})}}function hasRedirect(redirectTo){return!_.isEmpty(redirectTo)&&window.location.href.indexOf(redirectTo)==-1;}function isCloseOnSchedule(){return self.closeOnSchedule;}function redirect(redirectTo){if(hasRedirect(redirectTo)){window.location=redirectTo;return true;}return false;}IdentityAccountService.subscribeSkypeUpdate(NS,function(skypeID){if(self.isForm&&self.session){_setContact({'skypeID':skypeID});applyAsync(function($scope){$scope.session.skypeID=skypeID;});}});IdentityAccountService.subscribePhoneUpdate(NS,function(phone){if(self.isForm&&self.session){_setContact({'phoneNumber':phone});}});self.showConfirmation=function(){self.isForm=false;self.isConfirmation=true;SessionModalService.showConfirmation();};self.showLoading=function(message){self.isLoading=true;self.loadingMessage=message;};self.hideLoading=function(){self.isLoading=false;};self.serviceDown=function(){self.isError=true;self.isServiceError=true;self.isForm=false;self.isLoading=false;};self.setTimeslot=function(timeslot){if(self.session.schedule!=timeslot.timestamp){self.session.schedule=timeslot.timestamp;self.session.displayLongDate=timeslot.displayLongDate;self.session.displayShortDateTime=timeslot.displayShortDate+' '+timeslot.displayTime;self.session.displayShortDate=timeslot.displayShortDate;self.session.displayDayShort=timeslot.displayShortDate;self.session.displayTime=timeslot.displayTime;Analytics.trackEvent(_events.SELECT_DATE.category,_events.SELECT_DATE.action,Analytics.buildContext([_events.SELECT_DATE.label,'Value: '+timeslot.displayShortDate]));Analytics.trackEvent(_events.SELECT_TIME.category,_events.SELECT_TIME.action,Analytics.buildContext([_events.SELECT_TIME.label,'Value: '+timeslot.displayTime]));}};var _dialogID;Mediator.subscribe('VideoDetail.DIALOG','SELECTED',function(data){if(data.dialog&&data.dialog.dialogID){self.session=self.session?self.session:{};_dialogID=data.dialog.dialogID;self.session.dialogID=_dialogID;}});self.schedule=function(sessionType){if(!_.isEmpty(sessionType)){self.session.sessionType=sessionType;}if(!self.session.dialogID&&_dialogID){self.session.dialogID=_dialogID;}var submitSession=function(){clearErrors(sessionType);Analytics.trackEvent(_events.SUBMIT_STATUS.category,_events.SUBMIT_STATUS.action,Analytics.buildContext([_events.SKYPE_HELP_STATE.label,'Code: START']));if(!self.selectedTimezone&&self.session.timezone){self.selectedTimezone=self.session.timezone;}if(self.selectedTutor){self.session.tutorAccountID=self.selectedTutor;}else if(!self.tutorDropdownChanged&&self.selectedTutorFromBookAgainAvailable){self.session.tutorAccountID=self.selectedTutorFromBookAgain;}else if(!self.tutorDropdownChanged&&!self.selectedTutorFromBookAgainAvailable){self.session.tutorAccountID='';}else if(self.tutorDropdownChanged){self.session.tutorAccountID='';}if(self.selectedTimezone){if(self.selectedTimezone.name!=IdentityAccountService.getTimezone(true)||!_identity.timezone){SessionAppService.publishProcessing(self.session.sessionType,true,SessionAppService.getLoadingMessage('reserve'),'PUT');IdentityAccountService.setTimezone(self.selectedTimezone.name).then(function(){self.startTimeAnalytics=new Date().getTime();if(self.session.sessionID&&!self.session.isMissed&&!self.session.isReportPending){reschedule(self.session);}else{SessionAppService.postSession(self.session);}});}else{self.startTimeAnalytics=new Date().getTime();if(self.session.sessionID&&!self.session.isMissed&&!self.session.isReportPending){reschedule(self.session);}else{SessionAppService.postSession(self.session);}}}};submitSession();};var _index=0;self.startNow=function(){var ecLiveSession=SessionAppService.buildOpenTokSession(self.session);ecLiveSession.schedule=SessionAppService.getAvailableSlots(self.timeslotList)[_index].timestamp;SessionAppService.postSession(ecLiveSession).then(function(){Analytics.trackEvent('TutorSession','StartNow','SessionType: LT');},function(reason){if(SessionAppService.isDateUnavailabley(reason.data)){_index++;return self.startNow();}});};self.scheduleLater=function(){sessionApp.isFormToggled=false;Analytics.trackEvent('TutorSession','ScheduleLater','SessionType: LT');};self.redirect=function(){self.appInstance.redirect();};self.getTimeslots=function(){if(self.type=='LT'){_fetchTimeslot(self.type,self.date,self.selectedTutor);}};self.selectDate=function(date,dayIndex){self.dayIndex=dayIndex;self.date=date.dateRaw;};self.validateSkype=function(skype){return SkypeValidator.isValid(skype);};self.detectSkypeEmail=function(email){var msg=angular.element(\"#skype\").attr(\"warning-message\");var re=/^([\\w-]+(?:\\.[\\w-]+)*)@((?:[\\w-]+\\.)*\\w[\\w-]{0,66})\\.([a-z]{2,6}(?:\\.[a-z]{2})?)$/i;angular.element(\"#skype-text-container .ec-warning\").remove();if(re.test(email)){angular.element(\"#skype-text-container\").append(\"<label class='control-label has-error validationMessage ec-warning alert alert-warning'>\"+msg+\"</label>\");}};self.isEditSkype=true;self.hasSkypeID=false;self.setEditSkype=function(edit){self.isEditSkype=edit;};self.cancelEditSkype=function(){self.session.skypeID=self.currentSkypeID;self.setEditSkype(false);};self.isLateNight=function(dayPart){return dayPart==TimeslotConstants.PART_LATE_NIGHT;};self.isEarlyMorning=function(dayPart){return dayPart==TimeslotConstants.PART_EARLY_MORNING;};self.isMorning=function(dayPart){return dayPart==TimeslotConstants.PART_MORNING;};self.isAfternoon=function(dayPart){return dayPart==TimeslotConstants.PART_AFTERNOON;};self.isEvening=function(dayPart){return dayPart==TimeslotConstants.PART_EVENING;};self.isNight=function(dayPart){return dayPart==TimeslotConstants.PART_NIGHT;};self.submitSkype=function(){clearErrors(self.type);var success=function(){self.setEditSkype(false);self.loaderSkype.done('UpdateSkype');};var error=function(reason){SessionAppService.postSessionHandler(self.type,reason);self.loaderSkype.done('UpdateSkype');};self.loaderSkype.start('UpdateSkype');if(self.session.sessionID){return SessionAppService.updateSkype(self.session).then(success,error);}return ContactInformationService.post({accountID:_identity.accountID,contactType:'skype',contactValue:self.session.skypeID}).then(function(){IdentityAccountService.refresh().then(success)},error);};self.fetchTimeslot=_fetchTimeslot;self.showLongScheduleButton=function(){return!self.isReschedule&&!_identity.isPlatinum&&!self.isModal;};self.stopIntroVideo=function(){Mediator.publish('Player.SETMODAL','SessionController',null);};self.cancelSession=function(){SessionModalService.close();$timeout(function(){SessionModalService.openCancelSessionModal(self.session);},200)};function reschedule(session){if(session.isGoLive){if($scope.dialog&&$scope.dialog.dialog&&$scope.dialog.dialog.dialogID==session.dialogID){delete session.dialogID;}}SessionAppService.putSession(session);}SessionAppService.subscribeContact(self.subscriber,function(contact){_setContact(contact)},'GET');SessionAppService.subscribeSession(self.type,self.subscriber,function(session){_setSession(session);if(_.has(session,'sessionID')&&!session.isMissed){if(SessionModalService.isForm()){self.showForm();}else{self.showConfirmation();}}else{self.showForm();SessionModalService.showForm(false);}},'GET');SessionAppService.subscribeSession(self.type,self.subscriber,function(session){clearErrors(session.sessionType);_setSession(session);_setContact(session);if(!redirect(self.redirectTo)){self.hideLoading();self.showConfirmation();}if(isCloseOnSchedule()){Mediator.publish(\"SessionController.CLOSE\",'SessionController',true);}Analytics.trackEvent(_events.SUBMIT_STATUS.category,_events.SUBMIT_STATUS.action,Analytics.buildContext([_events.SKYPE_HELP_STATE.label,'Code: SUCCESS','SessionType: '+self.type]));},'POST');SessionAppService.subscribeSession(self.type,self.subscriber,function(session){clearErrors(session.sessionType);_setContact(session);},'PUT');SessionAppService.subscribeProcessing(self.type,self.subscriber,function(eventData){if(eventData.state){self.showLoading(eventData.message);}else{self.hideLoading();}},'PUT');SessionAppService.subscribeProcessing(self.type,self.subscriber,function(eventData){if(eventData.state){self.showLoading(eventData.message);}});Mediator.subscribe('ecSessionModalTrigger.DIRECTIVE',null,function(session){_fetchTimeslot(session.sessionType,self.date);});Mediator.subscribe('RegistrationController.CLICKREGISTER.CONTROLLER',null,function(){_fetchTimeslot('LT',self.date);});Mediator.subscribe(\"MySessionViewController.BOOKAGAIN\",\"SessionController\",function(session){setTutorDropDown(session);});Mediator.subscribe(\"LevelTestModal.SESSION\",\"SessionController\",function(session){_fetchTimeslot('LT',self.date,session.tutor.tutorAccountID);setTutorDropDown(session);});Mediator.subscribe(\"GoliveModal.SESSION\",\"SessionController\",function(data){var session=data.session;setTutorDropDown(session);});function setTutorDropDown(session){if(!session){return;}self.selectedTutorFromBookAgain='';self.selectedTutorFromBookAgainAvailable=true;self.tutorTopFive=false;if(session.tutor&&!session.tutor.isSuspended){self.selectedTutorFromBookAgain=session.tutor.tutorAccountID;self.tutorFromBookAgain=session.tutor;_.map(self.tutors,function(tutor){if(tutor.tutorAccountID==self.tutorFromBookAgain.tutorAccountID){self.tutorTopFive=true;}});}}Mediator.subscribe(\"BOOK.TUTOR\",\"SessionController\",function(params){self.session=self.session?self.session:{};self.tutor=params.tutor;self.selectedTimezone=params.timezone||self.selectedTimezone;self.session.timezoneDisplay=self.selectedTimezone.display;if(params.timeslot){_.map(self.timeslotList,function(timeslot,key){if(timeslot.displayDayShort==params.timeslot.displayDayShort){self.dayIndex=key;}});}if(!self.tutor.isSuspended){self.selectedTutor=self.tutor.tutorAccountID;self.getTimeslots();}});Mediator.subscribe(\"GoliveModal.SESSION\",\"SessionController\",function(data){self.selectedTutorFromBookAgain='';self.tutorFromBookAgain={};});self.events.skypeHelpModalClose={category:_events.SKYPE_HELP_STATE.category,action:_events.SKYPE_HELP_STATE.action,label:Analytics.buildContext([_events.SKYPE_HELP_STATE.label,'Modal: Close'])};Mediator.subscribe('SkypeHelpModal.'+self.source+'.STATE','SessionApp',function(state){Analytics.trackEvent(_events.SKYPE_HELP_STATE.category,_events.SKYPE_HELP_STATE.action,Analytics.buildContext([_events.SKYPE_HELP_STATE.label,'Modal: '+state]));});IdentityAccountService.subscribeTimezoneUpdate(self.subscriber,function(timezoneName){var tzSelected=TimezoneService.getByName(timezoneName);self.selectedTimezone=tzSelected;self.session.timezone=tzSelected.name;self.session.timezoneDisplay=tzSelected.display;self.timezoneLoading=false;});SessionAppService.subscribeTimeslotList(self.type,self.subscriber,function(timeslotList){self.showLoading('');self.hideLoading();},'GET');self.hasError={'GL':false,'LT':false};function clearErrors(type){self.hasError[type]=false;self.sessionErrorMsg=\"\";self.sessionErrorUnknown=\"\";self.sessionTooManySessionChanges=false;}self.hasSessionError=function(type){return self.hasError[type];};SessionAppService.subscribeError(self.type,self.subscriber,function(eventData){self.hasError[self.type]=true;self.sessionErrorMsg=eventData.message;if(eventData.name=='skype'){Mediator.publish(self.skypeNamespace,self.subscriber,eventData.message);}if(eventData.name=='phone'){Mediator.publish(self.phoneNamespace,self.subscriber,eventData.message);}if(eventData.name=='sessionschedule'){self.isRefreshTimeslot=true;self.startTimeslotAnalytics=new Date().getTime();var params={sessionType:self.type};SessionAppService.getTimeslots(params,self.selectedTimezone.name,self.date,null,true).then(function(timeslots){_setTimeslot(timeslots);self.isRefreshTimeslot=false;});Mediator.publish(self.sessionscheduleNamespace,self.subscriber,eventData.message);if(self.sessionErrorMsg=='tooManySessionChanges'){self.sessionErrorMsg='';self.sessionTooManySessionChanges=true;}}if(eventData.name=='service'){self.sessionErrorMsg=\"\";self.serviceDown();}if(eventData.name=='timeslotnotavailable'){self.sessionErrorMsg='';self.isTimeslotNotAvailable=true;self.isLoading=false;self.hasError[self.type]=false;}var reason=(eventData.message&&eventData.message!=='')?eventData.message:'Unknown';self.sessionErrorUnknown=reason==\"Unknown\"||reason.data=='';Analytics.trackEvent(_events.SUBMIT_STATUS.category,_events.SUBMIT_STATUS.action,Analytics.buildContext([_events.SKYPE_HELP_STATE.label,'Code: ERROR','Reason: '+eventData.errorKey+' - '+reason,'SessionType: '+self.type]));self.hideLoading();},'GET');Mediator.subscribe('Session.CANCEL','SessionController',function(session){delete self.session.sessionID;delete self.session.dialogGoLive;self.session.isScheduled=false;self.session.isCancelled=true;self.session.isConfirmation=false;self.session.sessionType=session.sessionType;self.session.schedule=null;self.currentSkypeID=session.skypeID;self.session.dialogGoLive={};self.showForm(false);clearErrors(self.type);TutorSessionService.deleteSessionByNamespace();SessionAppService.publishSession(self.type,'GET',self.session);SessionAppService.setSession(self.session,'GET');});function _buildFieldNS(name){return self.subscriber+'.'+$scope.$id+'.'+name;}OutageService.getAllMessagesCount().then(function(messageCount){self.outageCount=messageCount;});SessionAppService.getSession(self.type).then(function(session){self.session=session;self.currentSkypeID=self.session.skypeID;if(session&&_.has(session,'sessionID')&&!session.isMissed){if(SessionModalService.isForm()){self.showForm();}else{self.showConfirmation();}}},function(){});}})(window,window.angular,window._);";
var mod_pagespeed_FC3$uSUkDE = "(function(angular){angular.module('EnglishCentralApp').controller('GoliveController',['$scope','IdentityAccountService','SessionModalService','SessionAppService','SessionConstants','FeatureSetService','Mediator',GoliveController]);function GoliveController($scope,IdentityAccountService,SessionModalService,SessionAppService,SessionConstants,FeatureSetService,Mediator){var self=this;var PAGE_SIZE=5;var features=FeatureSetService.getFeatureSet();self.subscriber='GoliveController';self.type='GL';$scope.sessionApp.isCarousel=true;$scope.sessionApp.carouselIndex=0;$scope.sessionApp.isVideoPicker=false;$scope.sessionApp.isLevelTestOption=false;$scope.dialog={};self.session={};$scope.sessionApp.getPrev=function(){_setDialogs($scope.sessionApp.dialogIterator.getPrev())};$scope.sessionApp.getNext=function(){_setDialogs($scope.sessionApp.dialogIterator.getNext());};$scope.sessionApp.setDialog=function(dialog){var tutorAccountID;$scope.dialog=dialog;$scope.sessionApp.isCarousel=false;if(!_.isEmpty($scope.sessionApp.session)){$scope.sessionApp.session.dialogID=dialog.dialogID;}if(self.session&&self.session.tutor){tutorAccountID=self.session.tutor.tutorAccountID;}else if($scope.sessionApp.session&&$scope.sessionApp.session.tutor&&!$scope.sessionApp.session.isCancelled){tutorAccountID=$scope.sessionApp.session.tutor.tutorAccountID;}else if($scope.sessionApp.tutor){tutorAccountID=$scope.sessionApp.tutor.tutorAccountID;}$scope.sessionApp.fetchTimeslot(SessionConstants.TYPE_GL,new Date(),tutorAccountID,$scope.dialog.dialogID).then(function(){if($scope.sessionApp.selectedTimeslot){_.map($scope.sessionApp.timeslotList,function(timeslot,key){if($scope.sessionApp.selectedTimeslot.displayDayShort==timeslot.displayDayShort){$scope.sessionApp.dayIndex=key;}});}});self.session={};};$scope.getGoLiveDialogs=function(refresh){var PAGE_SIZE=5;if(!IdentityAccountService.getIdentity().isBasic){SessionAppService.getDialogs({sessionType:self.type},refresh).then(function(dialogPaginator){$scope.sessionApp.dialogIterator=dialogPaginator.getIterator(PAGE_SIZE);_setDialogs($scope.sessionApp.dialogIterator.get());});}};$scope.showCarousel=function(){$scope.sessionApp.isCarousel=true;};$scope.hideCarousel=function(){$scope.sessionApp.isCarousel=false;};$scope.sessionApp.openLevelTestModal=function(){SessionModalService.openLeveltestModal().rendered.then(function(){var params={timezone:$scope.sessionApp.selectedTimezone,timeslot:$scope.sessionApp.selectedTimeslot,tutor:$scope.sessionApp.tutor};Mediator.publish(\"BOOK.TUTOR\",\"TutorController\",params);});};Mediator.subscribe('VideoFeedback.REFRESH',self.subscriber,function(){$scope.getGoLiveDialogs(true);});function init(session,showForm,isCarousel){if(session){if(session.sessionType==SessionConstants.TYPE_GL){_checkMode(session,showForm,isCarousel);}}}init($scope.sessionApp.session);function _getLastCancelledSession(data){if(!_.isEmpty($scope.sessionApp.session.dialogGoLive)){data.session.dialogGoLive=$scope.sessionApp.session.dialogGoLive;}}Mediator.subscribe('GoliveModal.SESSION',null,function(data){if(!_.isUndefined(data.session)){if(_.isUndefined(data.session.skypeID)&&!_.isUndefined($scope.sessionApp.session)){data.session.skypeID=$scope.sessionApp.session.skypeID;data.session=_getLastCancelledSession(data.session);}$scope.sessionApp.session=data.session;}init(data.session,data.showForm,data.isCarousel);});Mediator.subscribe('VideoDetail.DIALOG','SELECTED',function(data){var dialog=data.dialog||{};var showForm=_.isBoolean(data.showForm)?data.showForm:false;$scope.dialog=dialog;if(!_.isEmpty($scope.sessionApp.session)){_setMode(dialog);return;}if(dialog&&showForm){_setMode(dialog,showForm);}});SessionAppService.subscribeSession(self.type,self.subscriber,function(session){if(!_.isEmpty(session.dialog)){_setMode($scope.dialog);}},'GET');Mediator.subscribe(\"MySessionViewController.BOOKAGAIN\",\"SessionController\",function(session){$scope.$applyAsync(function(){$scope.sessionApp.session=session;self.session=session;if(session.isCompleted){delete self.session.sessionID;delete $scope.sessionApp.sessionID;}});});IdentityAccountService.subscribePhoneUpdate(self.subscriber,function(phone){if($scope.sessionApp.isForm&&$scope.sessionApp.session){$scope.$applyAsync(function(){$scope.sessionApp.session.phone=phone;$scope.sessionApp.session.phoneNumber=phone;});}});Mediator.subscribe(\"BOOK.TUTOR\",\"GoliveController\",function(params){$scope.sessionApp.session=$scope.sessionApp.session?$scope.sessionApp.session:{};$scope.sessionApp.tutor=params.tutor;$scope.sessionApp.selectedTimezone=params.timezone||$scope.sessionApp.selectedTimezone;$scope.sessionApp.session.timezoneDisplay=$scope.sessionApp.selectedTimezone.display;$scope.sessionApp.selectedTimeslot=params.timeslot;if(params.levelTestOption&&features.isLevelTestEnabled){$scope.sessionApp.isLevelTestOption=true;PAGE_SIZE=4;}if($scope.sessionApp.selectedTimeslot){_.map($scope.sessionApp.timeslotList,function(timeslot,key){if($scope.sessionApp.selectedTimeslot.displayDayShort==params.timeslot.displayDayShort){$scope.sessionApp.dayIndex=key;}});}if(!$scope.sessionApp.tutor.isSuspended){$scope.sessionApp.selectedTutor=$scope.sessionApp.tutor.tutorAccountID;}});function _setConfirmation(dialog){$scope.sessionApp.setDialog(dialog);$scope.sessionApp.showConfirmation();}function _setScheduler(dialog){$scope.sessionApp.setDialog(dialog);$scope.sessionApp.showForm();}function _checkMode(session,showForm,isCarousel){if(session.dialogGoLive&&session.dialogGoLive.dialog){_setMode(session.dialogGoLive.dialog,showForm,isCarousel);}}function _setMode(dialog,showForm,isCarousel){$scope.hideCarousel();if(isCarousel||(typeof isCarousel==\"undefined\"&&!dialog)){$scope.showCarousel();}else if($scope.sessionApp.session&&$scope.sessionApp.session.isScheduled&&$scope.sessionApp.session.dialogGoLive){var sessionDialog=$scope.sessionApp.session.dialogGoLive.dialog||null;if(!sessionDialog){return;}if(showForm){_setScheduler(sessionDialog);return;}if(dialog&&sessionDialog.dialogID==dialog.dialogID){_setScheduler(dialog);}else{_setConfirmation(sessionDialog);}}else{_setScheduler(dialog);}}function _setDialogs(dialogs){if(_.isEmpty(dialogs)){return;}$scope.sessionApp.hideLoading();$scope.sessionApp.dialogs=dialogs;}}})(angular);";
