var mod_pagespeed_1K7dMIIZVz = "(function(angular,_,moment){angular.module('EnglishCentralApp').factory('TutorSessionService',['$q','LocalCacheService','ConnectionFactory','SessionConstants','TutorSessionModel','IdentityAccountService',TutorSessionService]).factory(\"TutorSessionModel\",[\"SessionConstants\",'LanguageConstants','TimezoneService','IdentityAccountService',TutorSessionModel]);function TutorSessionService($q,Cache,ConnectionFactory,SessionConstants,TutorSessionModel,IdentityAccountService){var SessionREST=ConnectionFactory.get('tutor').one('session');var Service={};var locked=false;var currentPromise=null;var _sessionPostObservers=[function(){Service.deleteNextSessionCache();Service.deleteSessionsCache();}];Service.DEFAULT_PAGESIZE=8;Service.buildSessionModel=function(session){return TutorSessionModel.build(session);};function rejectPromise(error){var deferred=$q.defer();var promise=deferred.promise;deferred.reject(error);return promise;}function notifyObservers(observers,data){_.map(observers,function(callback){if(typeof callback=='function'){callback(data);}});}function publishSessionPost(session){notifyObservers(_sessionPostObservers,session);}Service.subscribeSessionPost=function(subscriber,callback){_sessionPostObservers.push(callback);};Service.getDefaultObject=function(sessionType){return TutorSessionModel.build({sessionType:sessionType});};Service.get=function(sessionID,query){if(!sessionID){return rejectPromise('no sessionID');}if(!_.isObject(query)){query={};}if(!query.fields){query.fields=SessionConstants.SESSION_FIELDS.join(',');}if(!query.reportFields){query.reportFields=SessionConstants.REPORT_FIELDS.join(',');}if(!query.tutorFields){query.tutorFields=SessionConstants.TUTOR_FIELDS.join(',');}if(!query.accountFields){query.accountFields=SessionConstants.ACCOUNT_FIELDS.join(',');}var generate=function(){return SessionREST.one(sessionID.toString()).customGET(null,query,{Accept:ConnectionFactory.getAcceptHeaderV2()}).then(function(session){return session.data;});};var buildSession=function(response){return TutorSessionModel.build(response,IdentityAccountService.getIdentity());};var format=function(response){if(_.isEmpty(response)){return{};}return TutorSessionModel.format(response);};return Cache.getPromise(SessionConstants.NAMESPACE,getSessionCacheKey(sessionID,query),generate,format,ConnectionFactory.getCacheExpiration('tutor')).then(buildSession,rejectPromise);};Service.getBySessionToken=function(sessionToken){var query={sessionToken:sessionToken};return this.getList(query).then(function(sessions){if(sessions&&!_.isEmpty(sessions)){return _.head(sessions);}return rejectPromise('no session found with the SessionID');});};Service.getBySessionId=function(sessionId){if(!sessionId){return rejectPromise('no sessionID specified');}var query={fields:SessionConstants.SESSION_FIELDS.join(','),reportFields:SessionConstants.REPORT_FIELDS.join(','),tutorFields:SessionConstants.TUTOR_FIELDS.join(','),accountFields:SessionConstants.ACCOUNT_FIELDS.join(',')};var generate=function(){return SessionREST.one(sessionId.toString()).customGET(null,query,{Accept:ConnectionFactory.getAcceptHeaderV2()});};var format=function(response){if(_.isEmpty(response)){return{};}return TutorSessionModel.format(response);};var buildSession=function(response){return TutorSessionModel.build(response,IdentityAccountService.getIdentity());};return Cache.getPromise(SessionConstants.NAMESPACE,{getBySessionId:sessionId},generate,format,ConnectionFactory.getCacheExpiration('tutor')).then(buildSession,rejectPromise);};Service.getOpenTokSession=function(sessionID){return SessionREST.one(sessionID.toString()).one('opentok').get().then(function(response){return{openTokAccessToken:response.data.openTokAccessToken,openTokSessionID:response.data.openTokSessionID};},function(error){return error;});};Service.getByDialogId=function(dialogId,status){return this.getList({},[SessionConstants.TYPE_GL],status).then(function(sessions){return _.reduce(sessions,function(acc,session){if(session.dialogGoLive.dialog.dialogID==dialogId){acc.push(session);}return acc;},[]);});};Service.isDialogSessionCompleted=function(dialogId){return this.getByDialogId(dialogId,[SessionConstants.STATUS_COMPLETED]).then(function(sessions){return!_.isEmpty(sessions);});};Service.setList=function(accountId,value,skipSetList){if(skipSetList){return false;}if(!value){value=[];}var generateSessionsCacheKey=function(accountId){return{component:SessionConstants.NS_SESSIONS,accountID:accountId,siteLanguage:IdentityAccountService.getIdentity().siteLanguage};};return Cache.set(SessionConstants.NAMESPACE,generateSessionsCacheKey(accountId),value,10);};Service.getRawList=function(query){var generate=function(){return SessionREST.get(query);};return Cache.getPromise(SessionConstants.NAMESPACE,query,generate,null,ConnectionFactory.getCacheExpiration('tutor')).then(function(sessions){var identity=IdentityAccountService.getIdentity();return _.map(sessions,function(session){return TutorSessionModel.build(TutorSessionModel.format(session),identity);});});};Service.getList=function(query,typeFilter,statusFilter){if(!IdentityAccountService.hasIdentity()){return rejectPromise('Anonymous');}if(_.isEmpty(query)){query={};}if(!typeFilter){if(query.sessionType){typeFilter=query.sessionType.split(',');}else{typeFilter=[];}}var defaultFilter=getDefaultFilter();if(!statusFilter){if(query.status){statusFilter=query.status.split(',');}else{statusFilter=defaultFilter;}}var identity=IdentityAccountService.getIdentity();if(!query.sessionType){query.sessionType=SessionConstants.VALID_TYPES.join(',');}if(!query.fields){query.fields=SessionConstants.SESSION_FIELDS.join(',');}if(!query.reportFields){query.reportFields=SessionConstants.REPORT_FIELDS.join(',');}if(!query.tutorFields){query.tutorFields=SessionConstants.TUTOR_FIELDS.join(',');}if(!query.accountFields){query.accountFields=SessionConstants.ACCOUNT_FIELDS.join(',');}var defaultParams={status:SessionConstants.VALID_STATUS.join(','),uniquePerSession:true};if(query.status){defaultParams.status=query.status;}var normalizedQuery=_.clone(_.assign(query,defaultParams));var generate=function(){return SessionREST.get(normalizedQuery);};var rawSessionListPromise=Cache.getPromise(SessionConstants.NAMESPACE,getSessionsCacheKey(normalizedQuery),generate,formatSession,checkExpiry);return rawSessionListPromise.then(function(sessionListData){if(_.isEmpty(sessionListData)){sessionListData=[];}var filteredSessionListData=filterSessionListData(typeFilter,statusFilter,sessionListData);return _.map(filteredSessionListData,function(session){return TutorSessionModel.build(session,identity);});},rejectPromise);};Service.iterator=function(params,typeFilter,statusFilter){var self=Service;if(!params){params={};}if(!params.pageSize){params.pageSize=self.DEFAULT_PAGESIZE;}var Iterator=new _.iterator();Iterator.pageSize=params.pageSize;Iterator.getCount=function(){var t=this;return self.getCount(params).then(function(count){t.updateCount(count);});};Iterator.getData=function(){return self.getList(_.assign(params,{sortBy:SessionConstants.SORT_DESC,uniquePerSession:true,page:Iterator.currentPage,pageSize:Iterator.pageSize}),typeFilter,statusFilter);};return Iterator;};function getDefaultFilter(){return[SessionConstants.STATUS_SCHEDULED,SessionConstants.STATUS_REQUESTED,SessionConstants.STATUS_COMPLETED,SessionConstants.STATUS_REPORT_PENDING,SessionConstants.STATUS_MISSED];}function formatSession(response){var defaultFilter=getDefaultFilter();if(_.isEmpty(response)){return[];}return _.map(_.filter(response,function(session){return session&&_.includes(defaultFilter,session.status);}),TutorSessionModel.format);}function checkExpiry(sessionListData){var CACHE_LIFETIME_SUPER_SHORT=30;var CACHE_LIFETIME_WHEN_NO_CACHE_CONTROL_HEADER_FOR_SESSION=180;var requested=_.find(sessionListData,function(session){return session.status==SessionConstants.STATUS_REQUESTED;});if(requested){return CACHE_LIFETIME_SUPER_SHORT;}return CACHE_LIFETIME_WHEN_NO_CACHE_CONTROL_HEADER_FOR_SESSION;}function isFiltered(filter,item){return filter.length&&!_.includes(filter,item);}function filterSessionListData(typeFilter,statusFilter,sessionListData){return _.reduce(sessionListData,function(filteredSessions,session){if(!isFiltered(typeFilter,session.sessionType)&&!isFiltered(statusFilter,session.status)){filteredSessions.push(session);}return filteredSessions;},[]);}Service.getNext=function(query,refresh){if(!IdentityAccountService.hasIdentity()){return rejectPromise('Anonymous');}if(refresh){this.deleteNextSessionCache();}if(_.isEmpty(query)){query={};}var identity=IdentityAccountService.getIdentity();query.accountID=identity.accountID;if(!query.sessionType){if(identity.isPremium||identity.isPlatinum){query.sessionType=SessionConstants.VALID_TYPES.join(',');}else{query.sessionType=SessionConstants.TYPE_LT;}}if(!query.fromDate){query.fromDate=_.getBsonDate();}if(!query.fields){query.fields=SessionConstants.SESSION_FIELDS.join(',');}if(!query.reportFields){query.reportFields=SessionConstants.REPORT_FIELDS.join(',');}if(!query.tutorFields){query.tutorFields=SessionConstants.TUTOR_FIELDS.join(',');}if(!query.accountFields){query.accountFields=SessionConstants.ACCOUNT_FIELDS.join(',');}var generate=function(){return SessionREST.one('nextSession').get(query);};var format=function(response){if(_.isEmpty(response)){return{};}return TutorSessionModel.format(response);};return Cache.getPromise(SessionConstants.NAMESPACE,getNextSessionCacheKey(),generate,format,ConnectionFactory.getCacheExpiration('tutor')).then(function(nextSessionData){return TutorSessionModel.build(nextSessionData,identity);},rejectPromise);};Service.getCount=function(params){if(!IdentityAccountService.hasIdentity()){return rejectPromise('Anonymous');}if(!params){params={};}var normalizedQuery={uniquePerSession:true,sessionType:SessionConstants.VALID_TYPES.join(','),status:SessionConstants.VALID_PAGINATION_STATUS.join(',')};var newParams=_.clone(params);var buildCount=function(count){return count>0?count:0;};if(newParams.status){normalizedQuery.status=newParams.status;}var currentParams=_.clone(_.assign(newParams,normalizedQuery));return this.getRawCount(currentParams,true).then(buildCount,rejectPromise);};Service.getRawCount=function(query,isTotalCount){if(!IdentityAccountService.hasIdentity()){return rejectPromise('Anonymous');}if(_.isEmpty(query)){query={};}var generate=function(){return SessionREST.one('count').get(query);};if(!isTotalCount){return generate();}return Cache.getPromise(SessionConstants.NAMESPACE,getSessionsCountCacheKey(query,isTotalCount),generate);};function validSession(session){return true;if(!session||!session.schedule||!session.sessionType){return false;}return true;}function validPutSession(session){if(!session||!session.schedule){return false;}return true;}Service.post=function(session,skipPublish){if(!IdentityAccountService.hasIdentity()){return rejectPromise('Anonymous');}if(!validSession(session)){return rejectPromise('Missing Parameters');}if(locked){return currentPromise;}locked=true;var identity=IdentityAccountService.getIdentity();var query={accountID:identity.accountID,fields:SessionConstants.SESSION_FIELDS.join(','),reportFields:SessionConstants.REPORT_FIELDS.join(','),tutorFields:SessionConstants.TUTOR_FIELDS.join(','),accountFields:SessionConstants.ACCOUNT_FIELDS.join(',')};var params=_.merge(session,query);currentPromise=SessionREST.customPOST(null,null,params,{Accept:ConnectionFactory.getAcceptHeaderV2()}).then(function(response){var newSession=TutorSessionModel.build(TutorSessionModel.format(response.data),identity);if(!skipPublish){publishSessionPost(newSession);}return newSession;},rejectPromise)\n['finally'](function(){if(!skipPublish){locked=false;}});return currentPromise;};Service.put=function(session,skipPublish){if(!IdentityAccountService.hasIdentity()){return rejectPromise('Anonymous');}if(!validPutSession(session)){return rejectPromise('Missing Parameters');}if(locked){return currentPromise;}locked=true;var query={fields:SessionConstants.SESSION_FIELDS.join(','),reportFields:SessionConstants.REPORT_FIELDS.join(','),tutorFields:SessionConstants.TUTOR_FIELDS.join(','),accountFields:SessionConstants.ACCOUNT_FIELDS.join(',')};var params=_.merge(session,query);var identity=IdentityAccountService.getIdentity();currentPromise=SessionREST.one(session.sessionID.toString()).one('reschedule').customPUT(null,null,params,{Accept:ConnectionFactory.getAcceptHeaderV2()}).then(function(response){var newSession=TutorSessionModel.build(TutorSessionModel.format(response.data),identity);if(!skipPublish){publishSessionPost(newSession);}return newSession;},rejectPromise)\n['finally'](function(){if(!skipPublish){locked=false;}});return currentPromise;};Service.cancelSession=function(session){if(!IdentityAccountService.hasIdentity()){return rejectPromise('Anonymous');}if(!session.sessionID){return rejectPromise('Missing Parameters');}var defaultParams={transitionReasonID:1};currentPromise=SessionREST.one(session.sessionID.toString()).one('cancel').customPUT(null,null,defaultParams,{Accept:ConnectionFactory.getAcceptHeaderV2()}).then(function(response){locked=false;publishSessionPost([]);},rejectPromise);return currentPromise;};Service.updatePhone=function(phone,sessionId){var params={phone:phone,sessionID:sessionId};return updateContact(params);};Service.updateSkype=function(skypeID,sessionId){var params={skypeID:skypeID,sessionID:sessionId};return updateContact(params);};Service.updateContact=function(skypeID,phone,sessionId){var params={skypeID:skypeID,phone:phone,sessionID:sessionId};return updateContact(params);};function getNextSessionCacheKey(){var identity=IdentityAccountService.getIdentity();return{component:SessionConstants.NS_NEXT_SESSION,accountID:identity.id,siteLanguage:IdentityAccountService.getIdentity().siteLanguage};}function getSessionsCacheKey(query){if(!query){query={};}var identity=IdentityAccountService.getIdentity();var defaultParams={component:SessionConstants.NS_SESSIONS,accountID:identity.id,siteLanguage:IdentityAccountService.getIdentity().siteLanguage};if('tutorAccountIDs'in query){defaultParams.tutorAccountIDs=query.tutorAccountIDs;}if('pageSize'in query&&query.pageSize>0){return _.assign(defaultParams,{sortBy:SessionConstants.SORT_DESC,pageSize:query.pageSize||0,page:query.page||0});}if('sessionType'in query){return _.assign(defaultParams,{sessionType:query.sessionType});}return defaultParams;}function getSessionsCountCacheKey(query,isTotalCount){if(!query){query={};}var identity=IdentityAccountService.getIdentity();var defaultParams={component:SessionConstants.NS_SESSIONS_COUNT,accountID:identity.id,siteLanguage:IdentityAccountService.getIdentity().siteLanguage,};if(isTotalCount||_.isEmpty(query)){}return _.assign(defaultParams,query);}function getSessionCacheKey(sessionID,query){if(!query){query={};}var identity=IdentityAccountService.getIdentity();var defaultParams={component:SessionConstants.NS_SESSION,accountID:identity.id,siteLanguage:IdentityAccountService.getIdentity().siteLanguage,sessionID:sessionID};return _.assign(defaultParams,query);}function updateContact(params){return SessionREST.one('contact').put(params).then(function(response){Service.deleteSessionsCache();var identity=IdentityAccountService.getIdentity();return TutorSessionModel.build(TutorSessionModel.format(response.data),identity);},rejectPromise);}Service.deleteNextSessionCache=function(){Cache.remove(SessionConstants.NAMESPACE,getNextSessionCacheKey());};Service.deleteSessionsCache=function(params){if(!params){params={sessionType:SessionConstants.VALID_TYPES.join(',')};var LTGLPostParams={sessionType:SessionConstants.VALID_TYPES.join(','),status:SessionConstants.VALID_STATUS.join(','),uniquePerSession:true,sortBy:SessionConstants.SORT_DESC};Cache.remove(SessionConstants.NAMESPACE,getSessionsCacheKey(LTGLPostParams));Cache.removeMemory(SessionConstants.NAMESPACE,getSessionsCacheKey(LTGLPostParams));}Cache.remove(SessionConstants.NAMESPACE,getSessionsCacheKey(params));Cache.removeMemory(SessionConstants.NAMESPACE,getSessionsCacheKey(params));Service.deleteSessionsPaginationCache(params);Service.deleteSessionsCountCache(params);Service.deleteSessionsCountCache({uniquePerSession:true,sessionType:SessionConstants.VALID_TYPES.join(','),status:SessionConstants.VALID_PAGINATION_STATUS.join(',')});};Service.deleteSessionsPaginationCache=function(params){if(!params){params={};}if(!params.pageSize){params.pageSize=this.DEFAULT_PAGESIZE;}this.getCount().then(function(count){var totalPages=Math.ceil(count/params.pageSize);_.map(_.range(totalPages),function(page){Cache.remove(SessionConstants.NAMESPACE,getSessionsCacheKey({pageSize:params.pageSize,page:page}));Cache.removeMemory(SessionConstants.NAMESPACE,getSessionsCacheKey({pageSize:params.pageSize,page:page}));});});};Service.deleteSessionsCountCache=function(params){if(!params){params={};}Cache.remove(SessionConstants.NAMESPACE,getSessionsCountCacheKey(params,true));Cache.removeMemory(SessionConstants.NAMESPACE,getSessionsCountCacheKey(params,true));};Service.deleteSessionByNamespace=function(){Cache.removeLocalCacheNamespace(SessionConstants.NAMESPACE);};Service.getSessionCalendar=function(sessionToken){var query={fields:SessionConstants.SESSION_FIELDS.join(','),reportFields:SessionConstants.REPORT_FIELDS.join(','),tutorFields:SessionConstants.TUTOR_FIELDS.join(','),accountFields:SessionConstants.ACCOUNT_FIELDS.join(',')};return SessionREST.one('calendar').one(sessionToken.toString()).customGET(null,query,{Accept:ConnectionFactory.getAcceptHeaderV2()}).then(function(response){return TutorSessionModel.build(response.data,IdentityAccountService.getIdentity());},rejectPromise);};return Service;}function TutorSessionModel(SessionConstants,LanguageConstants,TimezoneService,IdentityAccountService){function _getLocalDate(data,identity){var locale;if(!identity||!identity.siteLanguage){locale=LanguageConstants.ENGLISH;}else if(identity.siteLanguage==LanguageConstants.CHINESE){locale=LanguageConstants.CHINESE_SIMPLIFIED;}else{locale=identity.siteLanguage;}return moment.tz(data.schedule,IdentityAccountService.getTimezone()).locale(locale);}function getDisplayScheduleFormat(localDate,identity){var locale;if(!identity||!identity.siteLanguage){locale=LanguageConstants.JAPANESE;}else{locale=identity.siteLanguage;}if(_.indexOf([LanguageConstants.JAPANESE],locale)!=-1){return localDate.format('MMMM D日 (dddd) @ H:mm');}if(_.indexOf([LanguageConstants.KOREAN],locale)!=-1){return localDate.format('LLLL');}return localDate.format('dddd, MMMM DD, HH:mm');}function getDisplayDayFormat(localDate,identity){var locale;if(!identity||!identity.siteLanguage){locale=LanguageConstants.JAPANESE;}else{locale=identity.siteLanguage;}if(_.indexOf([LanguageConstants.JAPANESE],locale)!=-1){return localDate.format('MMMM D日 (dddd) @ H:mm');}if(_.indexOf([LanguageConstants.KOREAN],locale)!=-1){return localDate.format('LLLL');}return localDate.format('dddd, MMMM DD, HH:mm');}function TutorSession(data,identity){if(data){_.assign(this,data);}this.isLevelTest=this.sessionType==SessionConstants.TYPE_LT;this.isLevelUpTest=this.sessionType==SessionConstants.TYPE_LUT;this.isGoLive=this.sessionType==SessionConstants.TYPE_GL;this.isScheduled=this.status==SessionConstants.STATUS_SCHEDULED||this.status==SessionConstants.STATUS_REQUESTED;this.isRescheduled=this.status==SessionConstants.STATUS_RESCHEDULED;this.isRequested=this.status==SessionConstants.STATUS_REQUESTED;this.isMissed=this.status==SessionConstants.STATUS_MISSED;this.isReportPending=this.status==SessionConstants.STATUS_REPORT_PENDING;this.isCancelled=this.status==SessionConstants.STATUS_CANCELLED;this.isCompleted=this.status==SessionConstants.STATUS_COMPLETED;this.timezoneEnabled=TimezoneService.enabled();if(identity){var localDate=_getLocalDate(data,identity);this.displayBaseSchedule=getDisplayScheduleFormat(localDate,identity);this.displaySchedule=this.displayBaseSchedule;this.displayDay=getDisplayDayFormat(localDate,identity);this.displayTime=localDate.format(\"LT\");this.displayDayShort=localDate.format(\"l\");this.timestamp=parseInt(localDate.format(\"X\"));if(TimezoneService.enabled()){this.displayTimezone=\"(GMT \"+localDate.format(\"Z\")+\")\";this.displaySchedule=this.displayBaseSchedule;this.displayScheduleWithTimezone=this.displaySchedule+\" \"+this.displayTimezone;this.displayCompleteTimezone=this.displayTimezone+\" \"+identity.timezone;}}if(!data.phoneNumber&&data.phone){this.phoneNumber=data.phone;}if(data.phoneNumber=='NULL'||data.phone=='NULL'){this.phoneNumber='';this.phone='';}if(data.skypeID=='NULL'){this.skypeID='';}if(data.dialogID=='NULL'){this.dialogID='';}}TutorSession.prototype={constructor:TutorSession};TutorSessionModel.format=function(data){if(_.isEmpty(data)){return{}}data.id=data.sessionID;data.costXP=data.sessionCostXP;data.displayLongDate=data.displaySchedule;data.displaySkypeID=data.skypeID;data.skypeID=data.skypeID;data.phoneNumber=data.phone;return data;};TutorSessionModel.build=function(data,identity){return new TutorSession(data,identity);};return TutorSessionModel;}})(window.angular,window._,window.moment);";
var mod_pagespeed_uceBlnQAGG = "(function(angular){angular.module('EnglishCentralApp').service('SessionModalService',['$modal','$modalStack','Mediator','IdentityAccountService','SessionAppService','TutorSessionService',SessionModalService]);function SessionModalService($modal,$modalStack,Mediator,IdentityAccountService,SessionAppService,TutorSessionService){var Service={};var ReportModalController='ReportModalController';var identity=IdentityAccountService.getIdentity();var NS='SessionModalService';function resetFormState(){Service.isFormState=false;Service.isConfirmationState=false;}Service.showForm=function(resetState){Service.isFormState=true;Service.isConfirmationState=false;if(resetState===false){resetFormState();}};Service.showConfirmation=function(){Service.isConfirmationState=true;Service.isFormState=false;};Service.isConfirmation=function(){return Service.isConfirmationState;};Service.isForm=function(){return Service.isFormState;};Service.openReport=function(params){params=params||{};$modal.open({templateUrl:'session-report-modal.html',controller:'SessionReportController',controllerAs:'sessionReport',size:'lg',windowClass:'session-report-modal',resolve:params}).rendered.then(function(){Mediator.publish('SessionReport.LOAD',NS,params);});};Service.openLeveltestModal=function(params,options,showForm){params=params||{};options=_.isObject(options)?options:{};var addClass=options.windowClass?\" \"+options.windowClass:\"\";if(showForm){Service.showForm();}else{resetFormState();}var getWindowClass=function(){var defaultWindowClass='leveltest-modal';if(options.windowClass){return defaultWindowClass+\" \"+options.windowClass;}return defaultWindowClass;};return $modal.open({templateUrl:'leveltestSchedulerModal.html',controller:'SessionModalController',controllerAs:'levelTestModal',backdrop:true,size:options.size||'md',windowClass:getWindowClass(),resolve:{params:function(){return params;}}});};Service.openGoliveModal=function(isCarousel,showForm){if(showForm){this.showForm(true);}return $modal.open({templateUrl:'goliveSchedulerModal.html',controller:'SessionModalController',controllerAs:'goliveModal',backdrop:'static',windowClass:'golive-modal',resolve:{params:function(){return{showForm:showForm,isCarousel:isCarousel};}}});};Service.openCancelSessionModal=function(params){params=params||{};this.showForm(true);return $modal.open({templateUrl:'cancelSessionModal.html',controller:'SessionModalController',controllerAs:'cancelSessionModal',size:'md',windowClass:'cancelsession-modal',backdropClass:'cancelsession-modal-backdrop',backdrop:'static',resolve:{params:function(){return params;}}});};Service.closeReport=function(){$modalStack.dismissAll();};Service.close=function(){$modalStack.dismissAll();};Service.cancelSession=function(session){return TutorSessionService.cancelSession(session).then(function(){$modalStack.dismissAll();});};return Service;}})(angular);";
var mod_pagespeed_E_xqNjil2L = "(function(angular){angular.module('EnglishCentralApp').controller('SessionModalController',['$modalInstance','SessionModalService','params','Mediator',SessionModalController]);function SessionModalController($modalInstance,SessionModalService,params,Mediator){var self=this;self.params=params;self.cancelInProgress=false;self.error=null;self.isConfirmation=function(){return SessionModalService.isConfirmation();};self.isForm=function(){return SessionModalService.isForm();};self.close=function(){$modalInstance.close();};self.resetForm=function(){self.cancelInProgress=false;};self.setError=function(error){self.error=error;};self.hasError=function(){return self.error!=null;};self.isErrorCannotCancelPast=function(){return self.error==\"TUTOR_CANNOTCANCEL_PASTCANCELTHRESHOLD\";};self.cancel=function(session){function publishCancel(){$modalInstance.close();Mediator.publish('Session.CANCEL','SessionModalController',session);}self.cancelInProgress=true;return SessionModalService.cancelSession(session).then(function(){publishCancel()},function(error){if(error&&error.data){switch(error.data.key){case'TUTOR_CANNOTCANCEL_PASTCANCELTHRESHOLD':self.setError(\"TUTOR_CANNOTCANCEL_PASTCANCELTHRESHOLD\");break;}self.resetForm();}});};Mediator.subscribe(\"SessionController.CLOSE\",'SessionModalController',function(){self.close();})}}(window.angular));";
var mod_pagespeed_Y6AhEosnAm = "(function(angular,_){angular.module('EnglishCentralApp').factory('ContactInformationService',['$q','ConnectionFactory','LocalCacheService','IdentityAccountService',ContactInformationService]);function ContactInformationService($q,ConnectionFactory,LocalCacheService,IdentityAccountService){var Service={};var ContactInformationREST=ConnectionFactory.get('postoffice').one('contactinformation');var _postObservers=[];Service.post=function(params,skipPublish){if(_.isEmpty(params)){return rejectPromise(\"No parameter specified\");}var build=function(response){if(!skipPublish){publishPost(response);}return response.data;};return ContactInformationREST.post(null,{},params).then(build,rejectPromise);};Service.subscribePost=function(subscriber,callback){_postObservers.push(callback);};return Service;function rejectPromise(error){var deferred=$q.defer();var promise=deferred.promise;deferred.reject(error.data);return promise;}function notifyObservers(observers,data){_.map(observers,function(callback){if(typeof callback=='function'){callback(data);}});}function publishPost(session){notifyObservers(_postObservers,session);}}}(window.angular,window._));";
var mod_pagespeed_bgBqnOEL8Y = "(function(angular,_){angular.module('EnglishCentralApp').controller('ProgressRibbonController',['$scope','$timeout','EC_CONFIG','Mediator','SessionConstants','IdentityAccountService','TutorSessionService','IdentityProgressService','SessionModalService','FeatureSetService','ContentDialogListService','ReportCardWordService','ContactInformationService',ProgressRibbonController]);function ProgressRibbonController($scope,$timeout,Config,Mediator,SessionConstants,IdentityAccountService,TutorSessionService,IdentityProgressService,SessionModalService,FeatureSetService,ContentDialogListService,ReportCardWordService,ContactInformationService){var NS='ProgressRibbonController';var progressRibbon=Config.progressRibbon||{};var self=this;var nextSessionParams=getNextSessionParams();self.pronunciationVideoGoal=8;self.hasWordSummary=false;self.hasPronunciationSummary=false;self.activatePronTiles=false;self.vocabPageUrl='';self.hasSession=false;self.isCancelled=false;self.myVideosCount=0;self.openSessionModal=function(){if(self.nextSession.isLevelTest){SessionModalService.openLeveltestModal().rendered.then(function(){Mediator.publish('BOOK.TUTOR','ProgressRibbonController',{tutor:self.nextSession.tutor});});}else{SessionModalService.openGoliveModal(false).rendered.then(function(){Mediator.publish('GoliveModal.SESSION',NS,{session:self.nextSession,showForm:true});Mediator.publish('BOOK.TUTOR','ProgressRibbonController',{tutor:self.nextSession.tutor});});}};IdentityAccountService.subscribeProgressUpdate(NS,setExperiencePoints);IdentityAccountService.subscribeTutorAccountStatusUpdate(NS,setTutorAccountStatus);IdentityAccountService.subscribePronunciationUpdate(NS,setPronunciationSummary);TutorSessionService.subscribeSessionPost(NS,function(){$timeout(function(){setNextSession(TutorSessionService.getNext(nextSessionParams,true));},1500);});ContactInformationService.subscribePost(NS,function(){$timeout(function(){setNextSession(TutorSessionService.getNext(nextSessionParams,true));},1500);});Mediator.subscribe('ProgressRibbonController.UpdateMyWords',NS,function(){$timeout(function(){setWordSummary(true);},500);});IdentityAccountService.subscribeIdentityUpdate(\"EnglishCentralCtrl\",function(){if(IdentityAccountService.hasIdentity()){IdentityAccountService.getExperiencePoints().then(function(result){setExperiencePoints(result);});setTutorAccountStatus(IdentityAccountService.getTutorAccountStatus());}});(function init(){if(!IdentityAccountService.hasIdentity()){return;}setPronunciationSummary(IdentityProgressService.setPronunciationSummary(progressRibbon.pronStats));setExperiencePoints(IdentityAccountService.getExperiencePoints());setTutorAccountStatus(IdentityAccountService.getTutorAccountStatus());setWordSummary(false);if(FeatureSetService.isLevelTestEnabled()){setNextSession(TutorSessionService.getNext(nextSessionParams));}})();function getNextSessionParams(){var identity=IdentityAccountService.getIdentity();var params={};if(identity.isBasic||identity.isAcademic){params.sessionType=SessionConstants.TYPE_LT;}return params;}function setExperiencePoints(experiencePoints){if(experiencePoints){self.experiencePoints=experiencePoints;}}function setTutorAccountStatus(tutorStatus){if(tutorStatus&&tutorStatus.then){tutorStatus.then(function(status){self.tutorAccountStatus=status;})}else if(tutorStatus){self.tutorAccountStatus=tutorStatus;}}function setPronunciationSummary(pronunciationSummary){if(pronunciationSummary){self.pronunciationProgress=pronunciationSummary;self.hasPronunciationSummary=IdentityProgressService.hasPronunciationSummary;}}function setWordSummary(refresh){ReportCardWordService.getMyWordCount(refresh).then(function(wordSummary){if(wordSummary){self.wordProgress=wordSummary;self.hasWordSummary=wordSummary.all&&wordSummary.all>0;Mediator.publish('ProgressRibbonController.MyWordsUpdated','ProgressRibbonController',wordSummary);}});}function setNextSession(nextSession){var identity=IdentityAccountService.getIdentity();if(nextSession){nextSession.then(function(session){self.nextSession=session;if(session.isMissed&&(identity.isPremium||identity.isPlatinum)){if(identity.isPremium){IdentityAccountService.getTutorAccountStatus().then(function(status){self.hasSession=true;if(status.lessonEligibility[SessionConstants.TYPE_GL].isEligible||status.lessonEligibility[SessionConstants.TYPE_GL].requiredExperiencePoints==0){self.hasSession=false;}});}else if(identity.isPlatinum){self.hasSession=false;}}else{self.hasSession=_.has(session,'sessionID');}if(!$scope.$root.$$phase){$scope.$digest();}});}}Mediator.subscribe('Session.CANCEL',NS,function(){self.isCancelled=true;});}})(window.angular,window._);";
var mod_pagespeed_ZbC66ZS7MQ = "(function(angular){angular.module('EnglishCentralApp').controller('ExpSliderController',['$scope','Mediator','RibbonService','SessionAppService','SessionModalService','SessionConstants',function($scope,Mediator,RibbonService,SessionAppService,SessionModalService,SessionConstants){var self=this;self.experiencePoints={};self.closeExpSlider=function(){RibbonService.collapseSlider(true);};self.openGoLive=function(session){var isCarousel=false;SessionModalService.openGoliveModal(true).rendered.then(function(){self.closeExpSlider();if(_.isUndefined(session)){isCarousel=true;session={sessionType:SessionConstants.TYPE_GL};}else{isCarousel=false;}Mediator.publish('GoliveModal.SESSION','ExpSliderController',{session:session,showForm:true,isCarousel:isCarousel});});};$scope.$watch(function(){return RibbonService.experiencePoints;},function(data){self.experiencePoints=data;});SessionAppService.getSessionFeatures().then(function(features){self.isSessionEnabled=features.isLevelTestEnabled||features.isGoLiveEnabled;});}]);})(window.angular,window._);";
var mod_pagespeed_WXPW9M_6g5 = "angular.module('EnglishCentralApp').service('RibbonService',['IdentityAccountService',function(IdentityAccountService){var _state=true;var Service={};IdentityAccountService.subscribeProgressUpdate('RibbonService',_setExperiencePoints);if(IdentityAccountService.hasIdentity()){_setExperiencePoints(IdentityAccountService.getExperiencePoints(),true);}Service.state=true;Service.collapseSlider=function(state){if(_.isUndefined(state)){Service.state=!Service.state;}else{Service.state=state;}return Service.state;};Service.experiencePoints={};function _setExperiencePoints(experiencePoints){if(experiencePoints.then){experiencePoints.then(function(experiencePoints){Service.experiencePoints=experiencePoints;});}else{Service.experiencePoints=experiencePoints;}}return Service;}]);";
var mod_pagespeed_5I_uzwkaaD = "(function(angular){angular.module('EnglishCentralApp').factory('WordModel',[function(){var WORD_PROPERTIES={wordHeadID:0,favorite:false,known:false};function Word(wordData){var self=this;self=_.assign(self,WORD_PROPERTIES,_.pick(wordData,_.keys(WORD_PROPERTIES)));return self;}Word.prototype={constructor:Word,isFavorable:function(){return _.has(this,'isStudiable')&&this.isStudiable&&!this.excluded&&_.has(this,'wordHeadID')&&this.wordHeadID>0;}};return Word;}]);})(window.angular);";
var mod_pagespeed_5$DIf3$h6U = "(function(angular){angular.module('EnglishCentralApp').service('ReportCardWordService',['ConnectionFactory','IdentityAccountService','WordModel','LocalCacheService','$q',function(ConnectionFactory,IdentityAccountService,WordModel,Cache,$q){var NS='ReportCardWordService';var WordREST=ConnectionFactory.get('reportcard').one('report').one('word');var Service={};function rejectPromise(error){var deferred=$q.defer();var promise=deferred.promise;deferred.reject(error);return promise;}Service.getWordSummary=function(){if(!IdentityAccountService.hasIdentity()){return rejectPromise('Anonymous');}return WordREST.one('summary').get();};Service.getFavorites=function(){if(!IdentityAccountService.hasIdentity()){return rejectPromise('Anonymous');}return WordREST.one('favorites').get().then(function(response){return response.data;},function(){return[];});};Service.getWordState=function(params){return WordREST.one('state').get(params).then(function(response){return _.map(response.data,function(word){return new WordModel(word);})});};Service.getMyWordCount=function(refresh){if(!IdentityAccountService.hasIdentity()){return rejectPromise('Anonymous');}var cacheKey={accountID:IdentityAccountService.getIdentity().id};if(refresh){Cache.remove(NS,cacheKey);}var WordREST=ConnectionFactory.get('reportcard').withConfig(function(RestangularConfigurer){RestangularConfigurer.setResponseExtractor(function(response){response.originalElement=_.cloneDeep(response);return response;});}).one('report').one('word');var generate=function(){return WordREST.one('my').get();};var postProcessFn=function(response){return response.originalElement;};return Cache.getPromise(NS,cacheKey,generate,postProcessFn,ConnectionFactory.getCacheExpiration('tutor'));};function myWordHeadCache(){return{component:'MyWordHead',accountID:IdentityAccountService.getIdentity().id};}function myWordProgressCache(params){var query=_.assign({component:'MyWordProgress',accountID:IdentityAccountService.getIdentity().id},params);return query;}Service.clearMyWordHeadCache=function(){Cache.remove(NS,myWordHeadCache());};Service.getMyWordHeads=function(){var generate=function(){return WordREST.one('my').one('vocab').get();};return Cache.getPromise(NS,myWordHeadCache,generate,null,ConnectionFactory.getCacheExpiration('reportcard'));};Service.getMyWordProgress=function(params){var generate=function(){return WordREST.one('my').one('progress').get(params);};return Cache.getPromise(NS,myWordProgressCache(params),generate,null,ConnectionFactory.getCacheExpiration('reportcard')).then(function(result){return result;},function(reason){return reason;});};Service.getMyWordProgressCache=function(params){Cache.remove(NS,myWordProgressCache(params));};return Service;}]);})(window.angular);";
var mod_pagespeed_Um1H3x4la_ = "angular.module('EnglishCentralApp').directive('ecPronTile',[function(){var ASSET_SIZES=[22,40,60];var DEFAULT_SIZE='22';var DEFAULT_LABEL='AA';var DEFAULT_STRENGTH='unspoken';var BASE_RELATIVE_LOCATION='/images/pron/';var PREFIX='pet';var ASSET_EXT='png';function getSize(assetSize){return(_.indexOf(ASSET_SIZES,assetSize)>-1)?assetSize:DEFAULT_SIZE;}function getLocation(imageSize,fileName){return BASE_RELATIVE_LOCATION+imageSize+'x'+imageSize+'/'+fileName;}function getAssetFileName(strength,label){strength=_.isUndefined(strength)||_.isEmpty(strength)||strength=='default'?DEFAULT_STRENGTH:strength;label=_.isUndefined(label)||_.isEmpty(label)?DEFAULT_LABEL:label;return PREFIX+'-'+strength+'-'+label+'.'+ASSET_EXT;}return{scope:{pronObj:'=ecPronTile'},restrict:'A',link:function(scope,element,attrs){var phonemeAsset=getLocation(getSize(attrs.size),getAssetFileName(scope.pronObj.petStrength,scope.pronObj.petLabel));var style='url('+phonemeAsset+') center center no-repeat';element.css('background',style);}}}]);";
var mod_pagespeed_Oh6JXbXGAf = "(function(angular){angular.module('EnglishCentralApp').directive('ecRibbonSlide',['RibbonService',function(RibbonService){return{restrict:'A',link:function(scope,element,attrs){scope.slider={};scope.slider.isCollapsed=function(){return RibbonService.state;};scope.slider.toggleSlider=RibbonService.collapseSlider;var wrapEl=angular.element(document.getElementById('wrap'));wrapEl.on('click',function(){scope.$apply(function(){RibbonService.collapseSlider(true);})});}}}]);})(window.angular,window._);";
var mod_pagespeed_k31BfTh93J = "angular.module('EnglishCentralApp').directive('ecRibbonSlideToggle',['RibbonService',function(RibbonService){return{restrict:'A',link:function(scope,elem,attrs){elem.on('click',function(){scope.$apply(function(){RibbonService.collapseSlider();});});scope.$on('$destroy',function(){elem.off('click');scope.$destroy();});}}}]);";
var mod_pagespeed_4Z7dtAySNG = "angular.module('EnglishCentralApp').directive('ecGoLiveButtonToggle',['RibbonService',function(RibbonService){return{restrict:'A',controllerAs:'ecGoLiveButtonToggle',controller:['$q','$location','TutorSessionService','SessionConstants','IdentityAccountService','RoutesService','ScrollToFactory','EC_CONFIG','TutorStatusAccountService',function($q,$location,TutorSessionService,SessionConstants,IdentityAccountService,RoutesService,ScrollToFactory,Config,TutorStatusAccountService){var self=this;var ELIGIBILITY_ELIGIBLE='Eligible';self.bookNowURL=Config.goliveURL;self.isLoading=true;self.hasGoLive=false;self.showState=false;self.isMyenglishRoute=function(){return RoutesService.isRoute('myenglish');};TutorSessionService.subscribeSessionPost('ecGoLiveButtonToggle',function(){init();});function init(){if(IdentityAccountService.getIdentity().isBasic||IdentityAccountService.getIdentity().isAcademic){return;}$q.all({'sessions':TutorSessionService.getList({},[],[SessionConstants.STATUS_SCHEDULED,SessionConstants.STATUS_COMPLETED,SessionConstants.STATUS_MISSED,SessionConstants.STATUS_REPORT_PENDING]),'tutorStatus':TutorStatusAccountService.get(IdentityAccountService.getIdentity().id)}).then(function(data){var sessions=data.sessions;var tutorStatus=data.tutorStatus;self.isLoading=false;self.showState=true;self.hasGoLive=!_.isEmpty(sessions);if(isLevelTestCompleted(sessions)){if(tutorStatus['goLiveEligibility']!=ELIGIBILITY_ELIGIBLE){self.showState=false;}}if(isLevelTestScheduled(sessions)){if(tutorStatus['goLiveEligibility']!=ELIGIBILITY_ELIGIBLE){self.showState=false;}}if(_.isEmpty(sessions)){if(tutorStatus['goLiveEligibility']!=ELIGIBILITY_ELIGIBLE){self.showState=false;}}});}function isLevelTestScheduled(sessions){return!_.isEmpty(_.filter(sessions,{'isLevelTest':true}));}function isLevelTestCompleted(sessions){return!_.isEmpty(_.filter(sessions,{'isLevelTest':true,'isCompleted':true}));}(function(){init();})();}],link:function(scope,elem,attrs){}}}]);";
var mod_pagespeed_55kZaG1bfD = "angular.module('EnglishCentralApp').directive('ecSessionModalTrigger',['SessionConstants','Mediator',function(SessionConstants,Mediator){var LT_MODAL_ID='#leveltest-modal',GL_MODAL_ID='#golive-modal';return{scope:{session:'='},restrict:'A',link:function(scope,element,attrs){var modalID=LT_MODAL_ID;attrs.$observe('ecSessionModalTrigger',function(sessionType){if(!_.isEmpty(sessionType)){if(sessionType==SessionConstants.TYPE_LT){modalID=LT_MODAL_ID;}else if(sessionType==SessionConstants.TYPE_GL){modalID=GL_MODAL_ID;}element.attr(\"data-toggle\",\"modal\");element.attr('href',modalID);}});element.on('click',function(){var sessionType=attrs.ecSessionModalTrigger;if(scope.session){Mediator.publish(\"ecSessionModalTrigger.DIRECTIVE\",null,scope.session)}else{Mediator.publish(\"ecSessionModalTrigger.DIRECTIVE\",null,{sessionType:sessionType})}});}}}]);";
var mod_pagespeed_$e8tP8nK5T = "angular.module('EnglishCentralApp').directive('ecBgiframe',[function(){return{link:function(scope,element,attr){var params={conditional:true};element.bgiframe(params);}}}]);";
var mod_pagespeed_TtaFYEwF6b = "(function(factory){if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else{factory(jQuery);}}(function($){$.fn.bgiframe=function(s){s=$.extend({top:'auto',left:'auto',width:'auto',height:'auto',opacity:true,src:'javascript:false;',conditional:/MSIE 6.0/.test(navigator.userAgent)},s);if(!$.isFunction(s.conditional)){var condition=s.conditional;s.conditional=function(){return condition;};}var $iframe=$('<iframe class=\"bgiframe\"frameborder=\"0\"tabindex=\"-1\"src=\"'+s.src+'\"'+'style=\"display:block;position:absolute;z-index:-1;\"/>');return this.each(function(){var $this=$(this);if(s.conditional(this)===false){return;}var existing=$this.children('iframe.bgiframe');var $el=existing.length===0?$iframe.clone():existing;$el.css({'top':s.top=='auto'?((parseInt($this.css('borderTopWidth'),10)||0)*-1)+'px':prop(s.top),'left':s.left=='auto'?((parseInt($this.css('borderLeftWidth'),10)||0)*-1)+'px':prop(s.left),'width':s.width=='auto'?(this.offsetWidth+'px'):prop(s.width),'height':s.height=='auto'?(this.offsetHeight+'px'):prop(s.height),'opacity':s.opacity===true?0:undefined});if(existing.length===0){$this.prepend($el);}});};$.fn.bgIframe=$.fn.bgiframe;function prop(n){return n&&n.constructor===Number?n+'px':n;}}));";
